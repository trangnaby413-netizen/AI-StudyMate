<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI StudyMate ‚Äî Tr·ª£ l√Ω h·ªçc t·∫≠p th√¥ng minh</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* =====================================================
   RESET & ROOT
===================================================== */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  /* PALETTE ‚Äî Soft Aurora Light */
  --white: #ffffff;
  --off-white: #f7f8fc;
  --surface: #ffffff;
  --surface-2: #f0f2f9;
  --surface-3: #e8eaf4;
  --border: #e2e4ef;
  --border-light: #eef0f8;

  --ink-1: #1a1d2e;
  --ink-2: #3d4264;
  --ink-3: #7c82a8;
  --ink-4: #b0b5cc;

  /* BRAND GRADIENTS */
  --grad-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --grad-aurora: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  --grad-mint: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
  --grad-peach: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  --grad-blue: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
  --grad-violet: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
  --grad-rose: linear-gradient(135deg, #fda085 0%, #f6d365 100%);
  --grad-ocean: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --grad-success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  --grad-danger: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --grad-warn: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);

  --accent: #667eea;
  --accent-soft: rgba(102,126,234,0.1);
  --success: #10c98a;
  --danger: #f5576c;
  --warn: #fdcb6e;

  --shadow-xs: 0 1px 3px rgba(26,29,46,0.06), 0 1px 2px rgba(26,29,46,0.04);
  --shadow-sm: 0 4px 6px rgba(26,29,46,0.06), 0 2px 4px rgba(26,29,46,0.04);
  --shadow-md: 0 10px 24px rgba(26,29,46,0.08), 0 4px 8px rgba(26,29,46,0.04);
  --shadow-lg: 0 20px 48px rgba(26,29,46,0.1), 0 8px 16px rgba(26,29,46,0.05);
  --shadow-xl: 0 32px 64px rgba(26,29,46,0.12);

  --radius-xs: 6px;
  --radius-sm: 10px;
  --radius-md: 16px;
  --radius-lg: 22px;
  --radius-xl: 28px;
  --radius-pill: 9999px;

  --sidebar-w: 260px;
  --font-body: 'Plus Jakarta Sans', sans-serif;
  --font-display: 'Outfit', sans-serif;
}

html { scroll-behavior: smooth; }
FileInputStream serviceAccount =
new FileInputStream("path/to/serviceAccountKey.json");

FirebaseOptions options = new FirebaseOptions.Builder()
  .setCredentials(GoogleCredentials.fromStream(serviceAccount))
  .build();

FirebaseApp.initializeApp(options);
body {
  font-family: var(--font-body);
  background: var(--off-white);
  color: var(--ink-1);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* =====================================================
   DECORATIVE BG
===================================================== */
.bg-orbs {
  position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
}
.bg-orb {
  position: absolute; border-radius: 50%;
  filter: blur(60px); opacity: 0.35;
}
.orb-1 { width: 500px; height: 500px; background: radial-gradient(circle, #a8edea, transparent); top: -150px; right: -100px; }
.orb-2 { width: 400px; height: 400px; background: radial-gradient(circle, #fed6e3, transparent); bottom: -100px; left: -80px; }
.orb-3 { width: 300px; height: 300px; background: radial-gradient(circle, #e0c3fc, transparent); top: 40%; left: 30%; }

/* =====================================================
   APP SHELL
===================================================== */
#app { position: relative; z-index: 1; display: flex; min-height: 100vh; }

/* =====================================================
   SIDEBAR
===================================================== */
.sidebar {
  width: var(--sidebar-w);
  min-height: 100vh;
  background: var(--white);
  border-right: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  z-index: 100;
  transition: transform 0.3s ease;
}

.sb-header {
  padding: 24px 20px 20px;
  border-bottom: 1px solid var(--border-light);
}
.sb-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.sb-logo-badge {
  width: 44px; height: 44px;
  background: var(--grad-primary);
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
  box-shadow: 0 6px 16px rgba(102,126,234,0.35);
  flex-shrink: 0;
}
.sb-title { font-family: var(--font-display); font-size: 16px; font-weight: 800; color: var(--ink-1); }
.sb-tagline { font-size: 11px; color: var(--ink-3); font-weight: 500; margin-top: 2px; }

/* STUDENT PROFILE MINI */
.sb-profile {
  margin-top: 16px;
  background: var(--grad-aurora);
  border-radius: var(--radius-md);
  padding: 12px 14px;
  display: flex;
  align-items: center;
  gap: 10px;
}
.sb-avatar {
  width: 36px; height: 36px;
  background: var(--grad-primary);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 15px; color: white;
  flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.6);
}
.sb-pname { font-size: 13px; font-weight: 700; color: var(--ink-1); }
.sb-pgrade { font-size: 11px; color: var(--ink-2); font-weight: 500; }

/* NAV */
.sb-nav { flex: 1; padding: 16px 12px; overflow-y: auto; }
.nav-group { margin-bottom: 20px; }
.nav-group-label {
  font-size: 10px; font-weight: 700;
  color: var(--ink-4);
  text-transform: uppercase;
  letter-spacing: 1.2px;
  padding: 0 8px 8px;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 13.5px;
  font-weight: 600;
  color: var(--ink-3);
  transition: all 0.18s ease;
  margin-bottom: 2px;
  position: relative;
}
.nav-item:hover { background: var(--surface-2); color: var(--ink-1); }
.nav-item.active {
  background: var(--accent-soft);
  color: var(--accent);
}
.nav-item.active .ni-icon { background: var(--accent); }
.ni-icon {
  width: 28px; height: 28px;
  border-radius: 8px;
  background: var(--surface-2);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  transition: background 0.18s;
  flex-shrink: 0;
}
.nav-badge {
  margin-left: auto;
  background: var(--danger);
  color: white;
  font-size: 10px; font-weight: 700;
  padding: 2px 7px;
  border-radius: var(--radius-pill);
}
.nav-badge-new {
  margin-left: auto;
  background: var(--grad-ocean);
  color: white;
  font-size: 9px; font-weight: 800;
  padding: 2px 8px;
  border-radius: var(--radius-pill);
}

.sb-footer {
  padding: 14px 12px;
  border-top: 1px solid var(--border-light);
}
.logout-row {
  display: flex; align-items: center; gap: 10px;
  padding: 8px 12px; border-radius: var(--radius-sm);
  cursor: pointer; color: var(--ink-3);
  font-size: 13px; font-weight: 600;
  transition: all 0.18s;
}
.logout-row:hover { background: #fff0f0; color: var(--danger); }

/* =====================================================
   MAIN CONTENT
===================================================== */
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  padding: 28px 32px;
  min-height: 100vh;
}

/* =====================================================
   SCREENS
===================================================== */
.screen { display: none; animation: fadeUp 0.3s ease; }
.screen.active { display: block; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* =====================================================
   PAGE HEADER
===================================================== */
.page-header { margin-bottom: 24px; }
.page-title {
  font-family: var(--font-display);
  font-size: 26px;
  font-weight: 800;
  color: var(--ink-1);
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}
.page-sub { font-size: 14px; color: var(--ink-3); margin-top: 5px; font-weight: 500; }
.page-header-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 12px;
}
.chip {
  display: inline-flex; align-items: center; gap: 5px;
  background: var(--grad-primary);
  color: white;
  font-size: 11px; font-weight: 700;
  padding: 4px 12px;
  border-radius: var(--radius-pill);
  box-shadow: 0 3px 10px rgba(102,126,234,0.3);
}
.chip-sm {
  font-size: 10px; padding: 3px 9px;
}

/* =====================================================
   CARDS
===================================================== */
.card {
  background: var(--white);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-lg);
  padding: 22px;
  box-shadow: var(--shadow-sm);
  transition: box-shadow 0.2s, transform 0.2s;
}
.card:hover { box-shadow: var(--shadow-md); }
.card-title {
  font-size: 11px;
  font-weight: 700;
  color: var(--ink-4);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 16px;
}

/* GRADIENT HEADER CARDS */
.card-grad {
  position: relative;
  overflow: hidden;
  border: none;
}
.card-grad::before {
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0.12;
  background: inherit;
  border-radius: inherit;
}

/* =====================================================
   STAT CARDS
===================================================== */
.stat-card {
  background: var(--white);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-lg);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
}
.stat-card-accent {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}
.stat-icon {
  width: 44px; height: 44px;
  border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
  font-size: 20px;
  margin-bottom: 14px;
}
.stat-label { font-size: 12px; font-weight: 600; color: var(--ink-3); margin-bottom: 6px; }
.stat-value {
  font-family: var(--font-display);
  font-size: 30px;
  font-weight: 800;
  color: var(--ink-1);
  line-height: 1;
  margin-bottom: 8px;
}
.stat-change {
  font-size: 12px;
  font-weight: 600;
  display: flex; align-items: center; gap: 4px;
}
.change-up { color: var(--success); }
.change-dn { color: var(--danger); }
.change-nu { color: var(--ink-3); }

/* =====================================================
   GRIDS
===================================================== */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.g3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 20px; }
.g4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }
.g-main { display: grid; grid-template-columns: 1.6fr 1fr; gap: 20px; }

/* =====================================================
   ALERTS
===================================================== */
.alert {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px 16px;
  border-radius: var(--radius-md);
  margin-bottom: 10px;
  border: 1px solid transparent;
}
.alert-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
.alert-body strong { font-weight: 700; font-size: 14px; }
.alert-body p { font-size: 13px; margin-top: 2px; opacity: 0.8; }
.alert-danger {
  background: #fff5f5;
  border-color: #fed7d7;
  color: #c53030;
}
.alert-warn {
  background: #fffbeb;
  border-color: #fde68a;
  color: #b45309;
}
.alert-success {
  background: #f0fdf4;
  border-color: #bbf7d0;
  color: #166534;
}
.alert-info {
  background: #eff6ff;
  border-color: #bfdbfe;
  color: #1e40af;
}

/* =====================================================
   BUTTONS
===================================================== */
.btn {
  display: inline-flex; align-items: center; gap: 7px;
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  border: none; cursor: pointer;
  font-family: var(--font-body);
  font-size: 13.5px; font-weight: 700;
  transition: all 0.2s;
  white-space: nowrap;
}
.btn-primary {
  background: var(--grad-primary);
  color: white;
  box-shadow: 0 4px 12px rgba(102,126,234,0.3);
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.4); }
.btn-success {
  background: var(--grad-success);
  color: white;
  box-shadow: 0 4px 12px rgba(67,233,123,0.3);
}
.btn-success:hover { transform: translateY(-2px); }
.btn-outline {
  background: white;
  border: 1.5px solid var(--border);
  color: var(--ink-2);
}
.btn-outline:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-soft); }
.btn-danger {
  background: var(--grad-danger);
  color: white;
}
.btn-sm { padding: 7px 14px; font-size: 12.5px; }
.btn-block { width: 100%; justify-content: center; }

/* =====================================================
   FORMS
===================================================== */
.form-group { margin-bottom: 16px; }
.form-group label {
  display: block;
  font-size: 13px; font-weight: 700;
  color: var(--ink-2);
  margin-bottom: 6px;
}
input[type=text], input[type=number], input[type=password], input[type=email], select, textarea {
  width: 100%;
  background: var(--off-white);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  font-family: var(--font-body);
  font-size: 14px;
  color: var(--ink-1);
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(102,126,234,0.12);
  background: white;
}
select option { background: white; }
input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
input[type=number] { -moz-appearance: textfield; }
input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }

/* =====================================================
   PROGRESS BARS
===================================================== */
.progress-wrap { background: var(--surface-2); border-radius: var(--radius-pill); overflow: hidden; }
.progress-fill {
  height: 100%;
  border-radius: var(--radius-pill);
  transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
}
.progress-fill::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s infinite;
}
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(200%); }
}

/* =====================================================
   TABS
===================================================== */
.tabs-pill {
  display: flex; gap: 4px;
  background: var(--surface-2);
  border: 1px solid var(--border-light);
  padding: 4px;
  border-radius: var(--radius-pill);
}
.tab-pill {
  flex: 1; padding: 7px 12px;
  text-align: center;
  border-radius: var(--radius-pill);
  cursor: pointer;
  font-size: 13px; font-weight: 600;
  color: var(--ink-3);
  transition: all 0.2s;
}
.tab-pill.active {
  background: white;
  color: var(--accent);
  box-shadow: var(--shadow-sm);
}

/* =====================================================
   SUBJECT INPUT CARDS
===================================================== */
.subject-input-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
.subject-card {
  background: var(--off-white);
  border: 1.5px solid var(--border-light);
  border-radius: var(--radius-md);
  padding: 14px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.subject-card:hover { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-soft); }
.subject-card-head {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}
.subject-name {
  display: flex; align-items: center; gap: 7px;
  font-size: 13.5px; font-weight: 700; color: var(--ink-1);
}
.subject-score-input {
  background: white !important;
  border: 2px solid var(--border) !important;
  border-radius: var(--radius-xs) !important;
  padding: 6px 10px !important;
  font-size: 18px !important;
  font-weight: 800 !important;
  font-family: var(--font-display) !important;
  text-align: center;
  width: 70px !important;
  color: var(--ink-1) !important;
}
.subject-score-input:focus { border-color: var(--accent) !important; }
.score-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  display: inline-block;
}

/* =====================================================
   LOGIN PAGE
===================================================== */
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, setDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ƒêƒÉng k√Ω
window.registerUser = async function(email, password, name, grade){
  const userCredential = await createUserWithEmailAndPassword(auth, email, password);
  await setDoc(doc(db, "users", userCredential.user.uid), {
    name: name,
    grade: grade
  });
};

// ƒêƒÉng nh·∫≠p
window.loginUser = async function(email, password){
  await signInWithEmailAndPassword(auth, email, password);
};
</script>
    
<input id="login-email" placeholder="Email">
<input id="login-password" type="password" placeholder="M·∫≠t kh·∫©u">
<button onclick="loginUser()">ƒêƒÉng nh·∫≠p</button>
<input id="register-name" placeholder="T√™n">
<input id="register-email" placeholder="Email">
<input id="register-password" type="password" placeholder="M·∫≠t kh·∫©u">
<button onclick="registerUser()">ƒêƒÉng k√Ω</button>

window.registerUser = async function() {
  const email = document.getElementById("register-email").value;
  const password = document.getElementById("register-password").value;
  const name = document.getElementById("register-name").value;

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);

    await setDoc(doc(db, "users", userCredential.user.uid), {
      name: name,
      email: email,
      createdAt: new Date()
    });

    alert("ƒêƒÉng k√Ω th√†nh c√¥ng!");
  } catch (error) {
    alert(error.message);
  }
}

<input id="login-email" placeholder="Email">
<input id="login-password" type="password" placeholder="M·∫≠t kh·∫©u">
<button onclick="loginUser()">ƒêƒÉng nh·∫≠p</button>

window.loginUser = async function() {
  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-password").value;

  try {
    await signInWithEmailAndPassword(auth, email, password);
    alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
  } catch (error) {
    alert(error.message);
  }
}

onAuthStateChanged(auth, (user) => {
  if (user) {
    console.log("User ƒëang ƒëƒÉng nh·∫≠p:", user.email);
  } else {
    console.log("Ch∆∞a ƒëƒÉng nh·∫≠p");
  }
});
</script>
/* =====================================================
   QUIZ
===================================================== */
.quiz-container { max-width: 680px; margin: 0 auto; }
.quiz-step-dots { display: flex; gap: 5px; margin-bottom: 24px; }
.step-dot { height: 6px; border-radius: var(--radius-pill); background: var(--surface-3); transition: all 0.3s; }
.step-dot.done { background: var(--success); }
.step-dot.active { background: var(--accent); flex: 3; }
.step-dot.pending { flex: 1; }

.quiz-header-row {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 20px;
}
.quiz-category {
  font-size: 11px; font-weight: 700;
  color: var(--accent);
  text-transform: uppercase; letter-spacing: 1px;
  background: var(--accent-soft);
  padding: 4px 10px; border-radius: var(--radius-pill);
}
.quiz-counter { font-size: 13px; font-weight: 600; color: var(--ink-3); }
.quiz-question-text {
  font-size: 18px; font-weight: 700;
  color: var(--ink-1);
  line-height: 1.5;
  margin-bottom: 20px;
}
.quiz-options { display: flex; flex-direction: column; gap: 10px; }
.quiz-option {
  display: flex; align-items: center; gap: 14px;
  padding: 14px 18px;
  background: var(--off-white);
  border: 2px solid var(--border-light);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px; font-weight: 500;
}
.quiz-option:hover { border-color: var(--accent); background: var(--accent-soft); }
.quiz-option.selected {
  border-color: var(--accent);
  background: var(--accent-soft);
  color: var(--accent);
  font-weight: 700;
}
.quiz-radio {
  width: 20px; height: 20px;
  border-radius: 50%;
  border: 2px solid var(--border);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
}
.quiz-option.selected .quiz-radio {
  border-color: var(--accent);
  background: var(--accent);
}
.quiz-option.selected .quiz-radio::after {
  content: '';
  width: 8px; height: 8px;
  background: white;
  border-radius: 50%;
}
.quiz-nav {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-top: 24px;
}

/* =====================================================
   PERSONALITY RESULT
===================================================== */
.personality-result {
  max-width: 680px; margin: 0 auto;
  text-align: center;
}
.personality-card {
  background: white;
  border-radius: var(--radius-xl);
  padding: 40px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-light);
  position: relative;
  overflow: hidden;
}
.personality-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 5px;
  background: var(--grad-primary);
}
.pers-emoji { font-size: 60px; margin-bottom: 12px; display: block; }
.pers-type {
  font-family: var(--font-display);
  font-size: 24px; font-weight: 900;
  background: var(--grad-primary);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  margin-bottom: 10px;
}
.pers-desc { font-size: 14px; color: var(--ink-2); line-height: 1.7; margin-bottom: 24px; }

/* =====================================================
   ROADMAP
===================================================== */
.week-card {
  background: white;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-lg);
  overflow: hidden;
  margin-bottom: 14px;
  box-shadow: var(--shadow-xs);
  transition: box-shadow 0.2s;
}
.week-card:hover { box-shadow: var(--shadow-md); }
.week-header {
  padding: 16px 20px;
  display: flex; align-items: center;
  justify-content: space-between;
  cursor: pointer;
  transition: background 0.15s;
}
.week-header:hover { background: var(--off-white); }
.week-header-left { display: flex; align-items: center; gap: 14px; }
.week-badge {
  width: 40px; height: 40px;
  border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
  font-family: var(--font-display);
  font-size: 14px; font-weight: 900;
  color: white;
  flex-shrink: 0;
}
.week-title { font-size: 15px; font-weight: 700; color: var(--ink-1); }
.week-desc { font-size: 12px; color: var(--ink-3); margin-top: 2px; }
.week-status-pill {
  font-size: 11px; font-weight: 700;
  padding: 5px 12px; border-radius: var(--radius-pill);
}
.week-body { padding: 0 20px 16px; border-top: 1px solid var(--border-light); }
.week-body-inner { padding-top: 14px; }
.task-item {
  display: flex; align-items: flex-start; gap: 11px;
  padding: 9px 0;
  border-bottom: 1px solid var(--border-light);
}
.task-item:last-child { border-bottom: none; }
.task-checkbox {
  width: 20px; height: 20px;
  border: 2px solid var(--border);
  border-radius: 5px;
  cursor: pointer;
  flex-shrink: 0;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
  margin-top: 1px;
}
.task-checkbox.checked { background: var(--grad-success); border-color: #43e97b; }
.task-checkbox.checked::after { content: '‚úì'; color: white; font-size: 12px; font-weight: 800; }
.task-text { font-size: 13.5px; font-weight: 500; color: var(--ink-1); flex: 1; line-height: 1.4; }
.task-text.done { text-decoration: line-through; color: var(--ink-4); }
.task-time { font-size: 11px; color: var(--ink-3); font-weight: 600; margin-top: 2px; }

/* TIMELINE */
.timeline { position: relative; padding-left: 28px; }
.timeline::before {
  content: '';
  position: absolute;
  left: 7px; top: 10px; bottom: 10px;
  width: 2px;
  background: linear-gradient(180deg, var(--accent), rgba(102,126,234,0.1));
}
.tl-item { position: relative; margin-bottom: 20px; }
.tl-dot {
  position: absolute;
  left: -22px; top: 4px;
  width: 16px; height: 16px;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 0 0 2px;
}
.tl-dot.done { background: var(--success); box-shadow: 0 0 0 2px var(--success); }
.tl-dot.now { background: var(--accent); box-shadow: 0 0 0 2px var(--accent); animation: tlPulse 1.5s infinite; }
.tl-dot.upcoming { background: var(--off-white); box-shadow: 0 0 0 2px var(--border); }
@keyframes tlPulse { 0%,100%{box-shadow:0 0 0 2px var(--accent), 0 0 0 5px rgba(102,126,234,0.2)} 50%{box-shadow:0 0 0 2px var(--accent), 0 0 0 9px rgba(102,126,234,0)} }
.tl-time { font-size: 11px; color: var(--ink-3); font-weight: 600; margin-bottom: 3px; }
.tl-title { font-size: 14px; font-weight: 700; color: var(--ink-1); }
.tl-sub { font-size: 12px; color: var(--ink-3); margin-top: 2px; }

/* =====================================================
   EXAM
===================================================== */
.exam-q-card {
  background: var(--off-white);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-md);
  padding: 20px;
  margin-bottom: 14px;
}
.exam-q-text {
  font-size: 14.5px; font-weight: 600;
  color: var(--ink-1); line-height: 1.5;
  margin-bottom: 14px;
}
.exam-q-num {
  font-size: 11px; font-weight: 800;
  color: var(--accent);
  background: var(--accent-soft);
  padding: 3px 9px;
  border-radius: var(--radius-pill);
  margin-right: 8px;
}
.exam-options { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.exam-option {
  background: white;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  cursor: pointer;
  font-size: 13px; font-weight: 500;
  transition: all 0.18s;
  display: flex; align-items: center; gap: 8px;
}
.exam-option:hover { border-color: var(--accent); color: var(--accent); }
.exam-option.selected { border-color: var(--accent); background: var(--accent-soft); color: var(--accent); font-weight: 700; }
.exam-option.correct { border-color: var(--success); background: #f0fdf4; color: var(--success); font-weight: 700; }
.exam-option.wrong { border-color: var(--danger); background: #fff5f5; color: var(--danger); }
.opt-letter {
  width: 22px; height: 22px;
  border-radius: 50%;
  background: var(--surface-2);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 800;
  flex-shrink: 0;
}

/* TIMER */
.exam-timer {
  font-family: var(--font-display);
  font-size: 26px; font-weight: 900;
  color: var(--ink-1);
}
.exam-timer.warn { color: var(--warn); }
.exam-timer.danger { color: var(--danger); animation: timerShake 0.3s ease infinite; }
@keyframes timerShake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-2px)} 75%{transform:translateX(2px)} }

/* =====================================================
   SCHEDULE TABLE
===================================================== */
.sched-wrapper { overflow-x: auto; }
.sched-table { width: 100%; border-collapse: collapse; min-width: 640px; }
.sched-table th {
  padding: 10px 8px;
  font-size: 12px; font-weight: 700;
  color: var(--ink-3);
  text-align: center;
  border-bottom: 2px solid var(--border-light);
}
.sched-table th:first-child { text-align: left; }
.sched-table td { padding: 5px 4px; border-bottom: 1px solid var(--border-light); }
.sched-cell {
  padding: 7px 6px;
  border-radius: var(--radius-xs);
  font-size: 12px; font-weight: 700;
  text-align: center;
  min-height: 34px;
  display: flex; align-items: center; justify-content: center;
}
.sched-slot-label {
  font-size: 12px; font-weight: 600; color: var(--ink-3);
  white-space: nowrap; padding-right: 12px;
}

/* =====================================================
   COMPARE TABLE
===================================================== */
.compare-table { width: 100%; border-collapse: collapse; }
.compare-table th {
  text-align: left;
  padding: 10px 14px;
  font-size: 11px; font-weight: 700;
  color: var(--ink-3);
  text-transform: uppercase; letter-spacing: 0.8px;
  border-bottom: 2px solid var(--border-light);
}
.compare-table td { padding: 11px 14px; border-bottom: 1px solid var(--border-light); font-size: 13.5px; }
.compare-table tr:last-child td { border-bottom: none; }
.compare-table tr:hover td { background: var(--off-white); }

/* =====================================================
   ANALYSIS BLOCKS
===================================================== */
.analysis-block {
  padding: 14px 16px;
  border-radius: var(--radius-md);
  border-left: 4px solid;
  margin-bottom: 12px;
  background: var(--off-white);
}
.analysis-block-title { font-size: 13px; font-weight: 800; margin-bottom: 5px; }
.analysis-block-body { font-size: 13px; color: var(--ink-2); line-height: 1.6; }

/* AI OUTPUT BUBBLE */
.ai-response {
  background: linear-gradient(135deg, #eff6ff, #f5f3ff);
  border: 1px solid #c7d2fe;
  border-radius: var(--radius-lg);
  padding: 18px 20px;
  margin-bottom: 12px;
  position: relative;
}
.ai-response::before {
  content: '‚ú¶ AI StudyMate';
  display: block;
  font-size: 10px; font-weight: 800;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 10px;
}
.ai-response p { font-size: 13.5px; line-height: 1.8; color: var(--ink-1); }
.ai-response strong { color: var(--accent); }

/* LOADING */
.loading-dots { display: inline-flex; align-items: center; gap: 4px; }
.loading-dots span {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--accent);
  animation: ldot 1.2s infinite;
}
.loading-dots span:nth-child(2) { animation-delay: 0.2s; background: #764ba2; }
.loading-dots span:nth-child(3) { animation-delay: 0.4s; background: var(--accent); }
@keyframes ldot { 0%,100%{transform:scale(0.6);opacity:0.4} 50%{transform:scale(1);opacity:1} }

/* SCORE BADGE */
.score-badge {
  display: inline-flex; align-items: center; justify-content: center;
  width: 38px; height: 38px;
  border-radius: var(--radius-xs);
  font-family: var(--font-display);
  font-size: 14px; font-weight: 800;
  flex-shrink: 0;
}

/* PREDICT RING */
.pred-ring-wrap { text-align: center; }
.pred-circle {
  width: 100px; height: 100px;
  margin: 0 auto 8px;
  position: relative;
  display: flex; align-items: center; justify-content: center;
}
.pred-circle svg { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
.pred-text { position: relative; z-index: 1; }
.pred-num {
  font-family: var(--font-display);
  font-size: 22px; font-weight: 900;
  color: var(--ink-1);
}
.pred-lbl { font-size: 10px; color: var(--ink-3); font-weight: 600; }

/* =====================================================
   SCROLLBAR STYLE
===================================================== */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--ink-4); }

/* =====================================================
   MOBILE MENU BUTTON
===================================================== */
.mobile-menu-btn {
  display: none;
  position: fixed;
  top: 14px; left: 14px;
  z-index: 200;
  background: white;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 8px;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
}
.sidebar-overlay {
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.35);
  z-index: 99;
}

/* =====================================================
   TOAST
===================================================== */
.toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
.toast {
  background: white;
  border: 1px solid var(--border-light);
  border-radius: var(--radius-md);
  padding: 12px 18px;
  font-size: 13.5px; font-weight: 600;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: flex; align-items: center; gap: 10px;
  max-width: 340px;
}
@keyframes toastIn { from{opacity:0;transform:translateX(20px)translateY(10px)} to{opacity:1;transform:translateX(0)translateY(0)} }

/* =====================================================
   RESPONSIVE
===================================================== */
@media (max-width: 1024px) {
  .g-main { grid-template-columns: 1fr; }
}
@media (max-width: 900px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .sidebar-overlay.open { display: block; }
  .main { margin-left: 0; padding: 20px 16px 80px; }
  .mobile-menu-btn { display: flex; }
  .g4 { grid-template-columns: repeat(2, 1fr); }
  .g3 { grid-template-columns: repeat(2, 1fr); }
  .subject-input-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 560px) {
  .g2, .g3, .g4 { grid-template-columns: 1fr; }
  .subject-input-grid { grid-template-columns: 1fr 1fr; }
  .exam-options { grid-template-columns: 1fr; }
  .login-card { padding: 32px 24px; }
}
</style>
</head>
<body>

<!-- BG DECORATION -->
<div class="bg-orbs">
  <div class="bg-orb orb-1"></div>
  <div class="bg-orb orb-2"></div>
  <div class="bg-orb orb-3"></div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<!-- =====================================================
     LOGIN SCREEN
===================================================== -->
<div id="login-screen">
  <div class="login-deco ldeco-1"></div>
  <div class="login-deco ldeco-2"></div>
  <div class="login-deco ldeco-3"></div>

  <div class="login-card">
    <div class="login-hero">
      <div class="login-logo">üéì</div>
      <div class="login-title">AI StudyMate</div>
      <div class="login-sub">Tr·ª£ l√Ω h·ªçc t·∫≠p th√¥ng minh d√†nh cho h·ªçc sinh THCS & THPT</div>
    </div>

    <div class="tabs-pill" id="auth-tabs" style="margin-bottom:24px">
      <div class="tab-pill active" onclick="authSwitchTab('login',this)">ƒêƒÉng nh·∫≠p</div>
      <div class="tab-pill" onclick="authSwitchTab('register',this)">ƒêƒÉng k√Ω</div>
    </div>

    <div id="login-form">
      <div class="form-group">
        <label>H·ªç v√† t√™n</label>
        <input type="text" id="login-name" value="Nguy·ªÖn VƒÉn An" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
      </div>
      <div class="form-group">
        <label>L·ªõp</label>
        <select id="login-grade">
          <option value="6">L·ªõp 6 (THCS)</option>
          <option value="7">L·ªõp 7 (THCS)</option>
          <option value="8">L·ªõp 8 (THCS)</option>
          <option value="9">L·ªõp 9 (THCS)</option>
          <option value="10">L·ªõp 10 (THPT)</option>
          <option value="11">L·ªõp 11 (THPT)</option>
          <option value="12" selected>L·ªõp 12 (THPT)</option>
        </select>
      </div>
      <div class="form-group">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" value="123456" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button class="btn btn-primary btn-block" onclick="handleLogin()" style="margin-top:4px;padding:12px;">
        üöÄ B·∫Øt ƒë·∫ßu h·ªçc th√¥i!
      </button>
      <p style="text-align:center;font-size:12px;color:var(--ink-4);margin-top:12px">üí° Demo: Nh·∫•n n√∫t ƒë·ªÉ tr·∫£i nghi·ªám ngay</p>
    </div>

    <div id="register-form" style="display:none">
      <div class="form-group">
        <label>H·ªç v√† t√™n</label>
        <input type="text" placeholder="V√≠ d·ª•: Tr·∫ßn Th·ªã B√≠ch">
      </div>
      <div class="g2" style="gap:12px">
        <div class="form-group">
          <label>C·∫•p h·ªçc</label>
          <select>
            <option>THCS (L·ªõp 6‚Äì9)</option>
            <option>THPT (L·ªõp 10‚Äì12)</option>
          </select>
        </div>
        <div class="form-group">
          <label>L·ªõp c·ª• th·ªÉ</label>
          <select>
            <option>L·ªõp 10</option><option>L·ªõp 11</option><option>L·ªõp 12</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>M·∫≠t kh·∫©u</label>
        <input type="password" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
      </div>
      <button class="btn btn-success btn-block" onclick="handleLogin()" style="padding:12px;">
        ‚ú® T·∫°o t√†i kho·∫£n mi·ªÖn ph√≠
      </button>
    </div>

    <!-- FEATURES PREVIEW -->
    <div style="margin-top:28px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
      <span style="font-size:11.5px;color:var(--ink-3)">‚ú¶ AI ph√¢n t√≠ch ƒëi·ªÉm</span>
      <span style="font-size:11.5px;color:var(--ink-3)">‚ú¶ L·ªô tr√¨nh 4 tu·∫ßn</span>
      <span style="font-size:11.5px;color:var(--ink-3)">‚ú¶ D·ª± ƒëo√°n ƒëi·ªÉm thi</span>
      <span style="font-size:11.5px;color:var(--ink-3)">‚ú¶ ƒê·ªÅ √¥n t·∫≠p AI</span>
    </div>
  </div>
</div>

<!-- =====================================================
     MAIN APP
===================================================== -->
<button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">
  <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5">
    <path d="M3 7h14M3 12h14M3 17h14"/>
  </svg>
</button>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>

<div id="main-app" style="display:none">
  <div class="app-layout" id="app">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sb-header">
        <div class="sb-brand">
          <div class="sb-logo-badge">üéì</div>
          <div>
            <div class="sb-title">AI StudyMate</div>
            <div class="sb-tagline">H·ªçc th√¥ng minh h∆°n m·ªói ng√†y</div>
          </div>
        </div>
        <div class="sb-profile" id="sb-profile">
          <div class="sb-avatar" id="sb-avatar">A</div>
          <div>
            <div class="sb-pname" id="sb-pname">Nguy·ªÖn VƒÉn An</div>
            <div class="sb-pgrade" id="sb-pgrade">L·ªõp 12 ¬∑ THPT</div>
          </div>
        </div>
      </div>

      <nav class="sb-nav">
        <div class="nav-group">
          <div class="nav-group-label">T·ªïng quan</div>
          <div class="nav-item active" data-screen="dashboard" onclick="navigate(this)">
            <div class="ni-icon">üìä</div>
            Dashboard
          </div>
          <div class="nav-item" data-screen="scores" onclick="navigate(this)">
            <div class="ni-icon">‚úèÔ∏è</div>
            Nh·∫≠p ƒëi·ªÉm
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-label">Ph√¢n t√≠ch AI</div>
          <div class="nav-item" data-screen="analysis" onclick="navigate(this)">
            <div class="ni-icon">üß†</div>
            Ph√¢n t√≠ch ƒëi·ªÉm
          </div>
          <div class="nav-item" data-screen="predict" onclick="navigate(this)">
            <div class="ni-icon">üîÆ</div>
            D·ª± ƒëo√°n ƒëi·ªÉm thi
          </div>
          <div class="nav-item" data-screen="personality" onclick="navigate(this)">
            <div class="ni-icon">üí°</div>
            Test phong c√°ch h·ªçc
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-label">K·∫ø ho·∫°ch h·ªçc</div>
          <div class="nav-item" data-screen="roadmap" onclick="navigate(this)">
            <div class="ni-icon">üó∫Ô∏è</div>
            L·ªô tr√¨nh 4 tu·∫ßn
          </div>
          <div class="nav-item" data-screen="exam" onclick="navigate(this)">
            <div class="ni-icon">üìù</div>
            √în t·∫≠p t·ª± ƒë·ªông AI
            <span class="nav-badge-new">NEW</span>
          </div>
          <div class="nav-item" data-screen="schedule" onclick="navigate(this)">
            <div class="ni-icon">üìÖ</div>
            Th·ªùi kho√° bi·ªÉu AI
          </div>
        </div>
        <div class="nav-group">
          <div class="nav-group-label">Theo d√µi</div>
          <div class="nav-item" data-screen="progress" onclick="navigate(this)">
            <div class="ni-icon">üìà</div>
            Ti·∫øn b·ªô theo th√°ng
          </div>
          <div class="nav-item" data-screen="alerts" onclick="navigate(this)">
            <div class="ni-icon">üîî</div>
            C·∫£nh b√°o
            <span class="nav-badge" id="alert-badge">3</span>
          </div>
        </div>
      </nav>

      <div class="sb-footer">
        <div class="logout-row" onclick="handleLogout()">
          <span>‚Ü©</span>
          <span>ƒêƒÉng xu·∫•t</span>
        </div>
      </div>
    </aside>

    <!-- ===========================
         MAIN CONTENT
    =========================== -->
    <main class="main" id="main-content">

      <!-- ======= DASHBOARD ======= -->
      <div class="screen active" id="screen-dashboard">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <div class="page-title">
                üìä Dashboard
                <span class="chip chip-sm">‚ú¶ AI Powered</span>
              </div>
              <div class="page-sub" id="dash-subtitle">H·ªçc k·ª≥ 2 ¬∑ NƒÉm h·ªçc 2025‚Äì2026 ¬∑ L·ªõp 12</div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn btn-outline btn-sm" onclick="navigate(document.querySelector('[data-screen=scores]'))">+ Nh·∫≠p ƒëi·ªÉm m·ªõi</button>
              <button class="btn btn-primary btn-sm" onclick="navigate(document.querySelector('[data-screen=analysis]'))">üß† Xem ph√¢n t√≠ch AI</button>
            </div>
          </div>
        </div>

        <!-- ALERTS -->
        <div id="dash-alerts-container"></div>

        <!-- STAT CARDS -->
        <div class="g4" style="margin-bottom:22px" id="dash-stat-cards"></div>

        <!-- CHARTS -->
        <div class="g2" style="margin-bottom:22px">
          <div class="card">
            <div class="card-title">Bi·ªÉu ƒë·ªì nƒÉng l·ª±c c√°c m√¥n</div>
            <canvas id="chart-radar" height="240"></canvas>
          </div>
          <div class="card">
            <div class="card-title">Ti·∫øn b·ªô GPA 6 th√°ng qua</div>
            <canvas id="chart-gpa" height="240"></canvas>
          </div>
        </div>

        <!-- SUBJECTS + GOALS -->
        <div class="g2">
          <div class="card">
            <div class="card-title">T·ªïng quan ƒëi·ªÉm s·ªë</div>
            <div id="dash-subjects"></div>
          </div>
          <div class="card">
            <div class="card-title">Ti·∫øn ƒë·ªô ho√†n th√†nh m·ª•c ti√™u</div>
            <div id="dash-goals"></div>
          </div>
        </div>
      </div>

      <!-- ======= NH·∫¨P ƒêI·ªÇM ======= -->
      <div class="screen" id="screen-scores">
        <div class="page-header">
          <div class="page-title">‚úèÔ∏è Nh·∫≠p ƒëi·ªÉm c√°c m√¥n</div>
          <div class="page-sub">C·∫≠p nh·∫≠t ƒëi·ªÉm ƒë·ªÉ AI ph√¢n t√≠ch ch√≠nh x√°c v√† ƒë·ªÅ xu·∫•t l·ªô tr√¨nh t·ªëi ∆∞u</div>
        </div>

        <div class="card" style="margin-bottom:20px">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:20px">
            <div>
              <div style="font-size:16px;font-weight:800;color:var(--ink-1)">ƒêi·ªÉm th√°ng <span id="score-period">2/2026</span></div>
              <div style="font-size:13px;color:var(--ink-3);margin-top:3px">Thang ƒëi·ªÉm 10 ¬∑ Nh·∫≠p s·ªë th·∫≠p ph√¢n n·∫øu c·∫ßn (VD: 8.5)</div>
            </div>
            <select id="score-month-sel" style="width:auto" onchange="updateScorePeriod(this.value)">
              <option value="2/2026">Th√°ng 2/2026</option>
              <option value="1/2026">Th√°ng 1/2026</option>
              <option value="12/2025">Th√°ng 12/2025</option>
            </select>
          </div>
          <div class="subject-input-grid" id="subject-input-grid"></div>
          <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px;flex-wrap:wrap">
            <button class="btn btn-outline" onclick="buildSubjectInputGrid()">‚Ü∫ Nh·∫≠p l·∫°i</button>
            <button class="btn btn-primary" onclick="saveScores()">üíæ L∆∞u ƒëi·ªÉm &amp; C·∫≠p nh·∫≠t AI</button>
          </div>
        </div>

        <div class="card">
          <div class="card-title">üéØ ƒê·∫∑t m·ª•c ti√™u h·ªçc t·∫≠p</div>
          <div class="g3" style="gap:14px;align-items:end">
            <div class="form-group" style="margin:0">
              <label>M√¥n mu·ªën c·∫£i thi·ªán nh·∫•t</label>
              <select id="goal-subject">
                <option>To√°n</option><option>V·∫≠t l√Ω</option><option>H√≥a h·ªçc</option>
                <option>Sinh h·ªçc</option><option>Ng·ªØ vƒÉn</option><option>Ti·∫øng Anh</option>
                <option>L·ªãch s·ª≠</option><option>ƒê·ªãa l√Ω</option><option>GDCD</option>
              </select>
            </div>
            <div class="form-group" style="margin:0">
              <label>ƒêi·ªÉm m·ª•c ti√™u</label>
              <input type="number" id="goal-score-val" value="9.0" min="5" max="10" step="0.1">
            </div>
            <div class="form-group" style="margin:0">
              <label>Th·ªùi h·∫°n</label>
              <select id="goal-deadline">
                <option>4 tu·∫ßn t·ªõi</option>
                <option>8 tu·∫ßn t·ªõi</option>
                <option>Cu·ªëi h·ªçc k·ª≥</option>
                <option>Cu·ªëi nƒÉm h·ªçc</option>
              </select>
            </div>
          </div>
          <div style="margin-top:16px;display:flex;align-items:center;gap:12px">
            <button class="btn btn-success btn-sm" onclick="setGoal()">üéØ X√°c nh·∫≠n m·ª•c ti√™u</button>
            <div id="goal-confirm-msg"></div>
          </div>
        </div>
      </div>

      <!-- ======= PH√ÇN T√çCH AI ======= -->
      <div class="screen" id="screen-analysis">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <div class="page-title">üß† Ph√¢n t√≠ch ƒëi·ªÉm s·ªë AI
                <span class="chip chip-sm">‚ú¶ Claude API</span>
              </div>
              <div class="page-sub">K-Means Clustering ¬∑ Linear Regression ¬∑ ƒê√°nh gi√° to√†n di·ªán</div>
            </div>
            <button class="btn btn-primary btn-sm" id="btn-run-ai" onclick="runAIAnalysis()">
              ‚ú¶ Ch·∫°y ph√¢n t√≠ch AI
            </button>
          </div>
        </div>

        <div class="g2" style="margin-bottom:22px">
          <div>
            <div class="card" style="margin-bottom:20px">
              <div class="card-title">üìâ M√¥n c·∫ßn c·∫£i thi·ªán</div>
              <div id="weak-blocks"></div>
            </div>
            <div class="card">
              <div class="card-title">üìà ƒêi·ªÉm m·∫°nh n·ªïi b·∫≠t</div>
              <div id="strong-blocks"></div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">So s√°nh ƒëi·ªÉm c√°c m√¥n</div>
            <canvas id="chart-bar" height="330"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="card-title" style="display:flex;align-items:center;justify-content:space-between">
            <span>ü§ñ Nh·∫≠n x√©t &amp; T∆∞ v·∫•n t·ª´ AI</span>
          </div>
          <div id="ai-output">
            <div class="ai-response">
              <p>Nh·∫•n n√∫t <strong>‚ú¶ Ch·∫°y ph√¢n t√≠ch AI</strong> ·ªü tr√™n ƒë·ªÉ nh·∫≠n ƒë√°nh gi√° c√° nh√¢n ho√° chi ti·∫øt t·ª´ AI. H·ªá th·ªëng s·∫Ω ph√¢n t√≠ch xu h∆∞·ªõng ƒëi·ªÉm s·ªë, x√°c ƒë·ªãnh ƒëi·ªÉm y·∫øu/m·∫°nh, v√† ƒë·ªÅ xu·∫•t chi·∫øn l∆∞·ª£c h·ªçc t·ªëi ∆∞u nh·∫•t cho b·∫°n.</p>
            </div>
            <div id="ai-default-blocks"></div>
          </div>
        </div>
      </div>

      <!-- ======= D·ª∞ ƒêO√ÅN ƒêI·ªÇM ======= -->
      <div class="screen" id="screen-predict">
        <div class="page-header">
          <div class="page-title">üîÆ D·ª± ƒëo√°n ƒëi·ªÉm thi</div>
          <div class="page-sub">Linear Regression ¬∑ M√¥ ph·ªèng t√°c ƒë·ªông h·ªçc t·∫≠p ¬∑ X√°c su·∫•t ƒë·∫°t m·ª•c ti√™u</div>
        </div>

        <div class="g3" id="predict-rings" style="margin-bottom:22px"></div>

        <div class="g2">
          <div class="card">
            <div class="card-title">M√¥ ph·ªèng n·ªó l·ª±c h·ªçc t·∫≠p</div>
            <div class="form-group">
              <label>M√¥n m√¥ ph·ªèng</label>
              <select id="sim-subject" onchange="refreshSimChart()">
                <option>H√≥a h·ªçc</option><option>L·ªãch s·ª≠</option><option>To√°n</option><option>V·∫≠t l√Ω</option>
              </select>
            </div>
            <div class="form-group">
              <label>Th√™m <strong id="sim-hrs-val">2</strong> bu·ªïi h·ªçc/tu·∫ßn</label>
              <input type="range" min="0" max="7" value="2" id="sim-range" oninput="onSimChange(this.value)" style="margin-top:8px">
            </div>
            <div class="alert alert-info" id="sim-msg" style="margin-bottom:16px;font-size:13px"></div>
            <canvas id="chart-sim" height="195"></canvas>
          </div>
          <div class="card">
            <div class="card-title">X√°c su·∫•t ƒë·∫°t m·ª•c ti√™u</div>
            <div id="prob-bars"></div>
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border-light)">
              <div style="font-size:12px;color:var(--ink-3);line-height:1.6">
                üí° T·ª∑ l·ªá ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n xu h∆∞·ªõng c·∫£i thi·ªán hi·ªán t·∫°i, kho·∫£ng c√°ch ƒë·∫øn m·ª•c ti√™u v√† th·ªùi gian c√≤n l·∫°i.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ======= TEST T√çNH C√ÅCH ======= -->
      <div class="screen" id="screen-personality">
        <div class="page-header">
          <div class="page-title">üí° Test phong c√°ch h·ªçc t·∫≠p</div>
          <div class="page-sub">Kh√°m ph√° phong c√°ch h·ªçc t·ªëi ∆∞u c·ªßa b·∫°n ¬∑ 10 c√¢u h·ªèi ¬∑ ~3 ph√∫t</div>
        </div>

        <div id="quiz-area">
          <div class="quiz-container">
            <div class="card">
              <div class="quiz-step-dots" id="quiz-dots"></div>
              <div class="quiz-header-row">
                <span class="quiz-category" id="quiz-cat-label">Phong c√°ch h·ªçc</span>
                <span class="quiz-counter" id="quiz-num">C√¢u 1/10</span>
              </div>
              <div id="quiz-content"></div>
              <div class="quiz-nav">
                <button class="btn btn-outline" id="btn-quiz-prev" onclick="quizPrev()" style="opacity:0.4">‚Üê C√¢u tr∆∞·ªõc</button>
                <button class="btn btn-primary" id="btn-quiz-next" onclick="quizNext()">C√¢u ti·∫øp theo ‚Üí</button>
              </div>
            </div>
          </div>
        </div>

        <div id="quiz-result-area" style="display:none">
          <div class="personality-result">
            <div class="personality-card">
              <span class="pers-emoji" id="pers-emoji"></span>
              <div class="pers-type" id="pers-type"></div>
              <div class="pers-desc" id="pers-desc"></div>
              <div class="g2" style="text-align:left;margin-bottom:24px" id="pers-extras"></div>
              <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
                <button class="btn btn-outline" onclick="resetQuiz()">üîÑ L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
                <button class="btn btn-primary" onclick="navigate(document.querySelector('[data-screen=roadmap]'))">üó∫Ô∏è Xem l·ªô tr√¨nh c√° nh√¢n ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ======= L·ªò TR√åNH ======= -->
      <div class="screen" id="screen-roadmap">
        <div class="page-header">
          <div class="page-title">üó∫Ô∏è L·ªô tr√¨nh h·ªçc 4 tu·∫ßn</div>
          <div class="page-sub">ƒê∆∞·ª£c AI c√° nh√¢n ho√° d·ª±a tr√™n ƒëi·ªÉm s·ªë v√† phong c√°ch h·ªçc c·ªßa b·∫°n</div>
        </div>

        <div class="alert alert-info" style="margin-bottom:20px">
          <div class="alert-icon">üéØ</div>
          <div class="alert-body">
            <strong>M·ª•c ti√™u ƒë·∫∑t ra:</strong>
            <p>To√°n ƒë·∫°t 9.0 ¬∑ H√≥a h·ªçc 6.5 ‚Üí 7.5 ¬∑ Duy tr√¨ Ti·∫øng Anh 8.5+</p>
          </div>
        </div>

        <div id="roadmap-weeks-container"></div>

        <div class="card">
          <div class="card-title">üìÖ Timeline t·ªïng quan</div>
          <div class="timeline" id="roadmap-timeline"></div>
        </div>
      </div>

      <!-- ======= √îN T·∫¨P AI ======= -->
      <div class="screen" id="screen-exam">
        <div class="page-header">
          <div class="page-title">üìù √în t·∫≠p t·ª± ƒë·ªông AI
            <span class="chip chip-sm">‚ú¶ Auto Generated</span>
          </div>
          <div class="page-sub">AI t·∫°o ƒë·ªÅ √¥n t·∫≠p ph√π h·ª£p v·ªõi ƒëi·ªÉm y·∫øu v√† m·ª©c ƒë·ªô c·ªßa b·∫°n</div>
        </div>

        <!-- CONFIG -->
        <div id="exam-config-panel">
          <div style="max-width:560px">
            <div class="card">
              <div class="card-title">C·∫•u h√¨nh ƒë·ªÅ √¥n t·∫≠p</div>
              <div class="form-group">
                <label>M√¥n h·ªçc</label>
                <select id="exam-subject-sel">
                  <option>To√°n</option>
                  <option selected>H√≥a h·ªçc</option>
                  <option>V·∫≠t l√Ω</option>
                  <option>Ti·∫øng Anh</option>
                  <option>Ng·ªØ vƒÉn</option>
                </select>
              </div>
              <div class="form-group">
                <label>ƒê·ªô kh√≥</label>
                <div class="tabs-pill" id="exam-diff-tabs">
                  <div class="tab-pill active" onclick="setExamDiff(this,'easy')">üü¢ C∆° b·∫£n</div>
                  <div class="tab-pill" onclick="setExamDiff(this,'medium')">üü° Trung b√¨nh</div>
                  <div class="tab-pill" onclick="setExamDiff(this,'hard')">üî¥ N√¢ng cao</div>
                </div>
              </div>
              <div class="form-group">
                <label>S·ªë c√¢u h·ªèi</label>
                <select id="exam-count-sel">
                  <option value="5">5 c√¢u ‚Äì √în nhanh</option>
                  <option value="10" selected>10 c√¢u ‚Äì Ti√™u chu·∫©n</option>
                  <option value="15">15 c√¢u ‚Äì ƒê·∫ßy ƒë·ªß</option>
                </select>
              </div>
              <button class="btn btn-primary btn-block" onclick="launchExam()" style="padding:12px">
                ü§ñ AI t·∫°o ƒë·ªÅ ngay
              </button>
            </div>
          </div>
        </div>

        <!-- EXAM AREA -->
        <div id="exam-area-panel" style="display:none">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;margin-bottom:20px;background:white;border:1px solid var(--border-light);border-radius:var(--radius-lg);padding:16px 22px;box-shadow:var(--shadow-sm)">
            <div>
              <div style="font-size:17px;font-weight:800;color:var(--ink-1)" id="exam-heading"></div>
              <div style="font-size:13px;color:var(--ink-3);margin-top:3px" id="exam-subheading"></div>
            </div>
            <div style="display:flex;align-items:center;gap:16px">
              <div>
                <div style="font-size:11px;color:var(--ink-3);font-weight:600;margin-bottom:2px">Th·ªùi gian c√≤n l·∫°i</div>
                <div class="exam-timer" id="exam-timer-display">20:00</div>
              </div>
              <button class="btn btn-success" onclick="submitExam()">N·ªôp b√†i ‚úì</button>
            </div>
          </div>
          <div id="exam-questions-container"></div>
        </div>

        <!-- RESULT -->
        <div id="exam-result-panel" style="display:none">
          <div style="max-width:600px;margin:0 auto">
            <div class="card" style="text-align:center;padding:40px">
              <div style="font-size:56px;margin-bottom:12px" id="exam-result-emoji"></div>
              <div style="font-family:var(--font-display);font-size:26px;font-weight:900;margin-bottom:6px" id="exam-result-score"></div>
              <div style="font-size:14px;color:var(--ink-3);margin-bottom:24px" id="exam-result-msg"></div>
              <div id="exam-result-feedback" style="text-align:left;margin-bottom:24px"></div>
              <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
                <button class="btn btn-outline" onclick="retryExam()">üîÑ L√†m l·∫°i ƒë·ªÅ n√†y</button>
                <button class="btn btn-primary" onclick="newExam()">üìù ƒê·ªÅ m·ªõi</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ======= TH·ªúI KHO√Å BI·ªÇU ======= -->
      <div class="screen" id="screen-schedule">
        <div class="page-header">
          <div class="page-title">üìÖ Th·ªùi kho√° bi·ªÉu AI</div>
          <div class="page-sub">L·ªãch h·ªçc ƒë∆∞·ª£c t·ªëi ∆∞u ho√° d·ª±a tr√™n phong c√°ch h·ªçc v√† m·ª•c ti√™u c·ªßa b·∫°n</div>
        </div>
        <div class="card" style="margin-bottom:20px">
          <div class="card-title">L·ªãch h·ªçc t·ªëi ∆∞u trong tu·∫ßn</div>
          <div class="sched-wrapper" id="schedule-table-wrap"></div>
        </div>
        <div class="card">
          <div class="card-title">üí° Ph∆∞∆°ng ph√°p h·ªçc t·∫≠p ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t</div>
          <div class="g2" id="study-methods-grid"></div>
        </div>
      </div>

      <!-- ======= TI·∫æN B·ªò ======= -->
      <div class="screen" id="screen-progress">
        <div class="page-header">
          <div class="page-title">üìà Ti·∫øn b·ªô theo th√°ng</div>
          <div class="page-sub">So s√°nh ƒëi·ªÉm s·ªë tr∆∞·ªõc ‚Äì sau ¬∑ Xu h∆∞·ªõng c·∫£i thi·ªán theo th·ªùi gian</div>
        </div>

        <div class="g4" style="margin-bottom:22px" id="progress-stat-cards"></div>

        <div class="card" style="margin-bottom:20px">
          <div class="card-title">Bi·ªÉu ƒë·ªì ti·∫øn b·ªô t·ª´ng m√¥n (6 th√°ng g·∫ßn nh·∫•t)</div>
          <canvas id="chart-progress" height="220"></canvas>
        </div>

        <div class="card">
          <div class="card-title">So s√°nh chi ti·∫øt: Th√°ng 1 vs Th√°ng 2/2026</div>
          <div style="overflow-x:auto">
            <table class="compare-table" id="compare-table"></table>
          </div>
        </div>
      </div>

      <!-- ======= C·∫¢NH B√ÅO ======= -->
      <div class="screen" id="screen-alerts">
        <div class="page-header">
          <div class="page-header-row">
            <div>
              <div class="page-title">üîî C·∫£nh b√°o &amp; Th√¥ng b√°o</div>
              <div class="page-sub">AI t·ª± ƒë·ªông theo d√µi v√† c·∫£nh b√°o khi c√≥ bi·∫øn ƒë·ªông ƒëi·ªÉm s·ªë</div>
            </div>
            <button class="btn btn-outline btn-sm" onclick="markAllRead()">‚úì ƒê·ªçc t·∫•t c·∫£</button>
          </div>
        </div>
        <div id="alerts-container"></div>
      </div>

    </main>
  </div>
</div>

<script>
/* =====================================================
   AI STUDYMATE ‚Äî JAVASCRIPT CORE
   Full-featured learning assistant for THCS/THPT
===================================================== */

'use strict';

// =====================================================
// DATA
// =====================================================
const SUBJECTS = [
  { id: 'toan',  name: 'To√°n',      emoji: 'üìê', score: 8.7, prev: 7.9, target: 9.0, color: '#667eea' },
  { id: 'vatly', name: 'V·∫≠t l√Ω',    emoji: '‚ö°', score: 7.8, prev: 7.5, target: 8.0, color: '#764ba2' },
  { id: 'hoahoc',name: 'H√≥a h·ªçc',   emoji: 'üß™', score: 6.5, prev: 7.7, target: 7.5, color: '#f5576c' },
  { id: 'sinhhoc',name: 'Sinh h·ªçc', emoji: 'üåø', score: 8.0, prev: 7.8, target: 8.5, color: '#43e97b' },
  { id: 'nguvan',name: 'Ng·ªØ vƒÉn',   emoji: 'üìñ', score: 7.5, prev: 7.3, target: 8.0, color: '#fa709a' },
  { id: 'tienganh',name:'Ti·∫øng Anh',emoji: 'üåç', score: 8.5, prev: 8.2, target: 9.0, color: '#4facfe' },
  { id: 'lichsu', name: 'L·ªãch s·ª≠',  emoji: 'üìú', score: 6.8, prev: 7.0, target: 7.5, color: '#a18cd1' },
  { id: 'dialy',  name: 'ƒê·ªãa l√Ω',   emoji: 'üó∫Ô∏è', score: 7.2, prev: 7.0, target: 8.0, color: '#fda085' },
  { id: 'gdcd',   name: 'GDCD',     emoji: '‚öñÔ∏è', score: 8.3, prev: 8.0, target: 8.5, color: '#00c9ff' },
];

const MONTHLY_DATA = {
  labels: ['T9', 'T10', 'T11', 'T12', 'T1', 'T2'],
  gpa:    [7.4,  7.5,   7.6,   7.8,   7.9,  8.2],
  toan:   [7.2,  7.5,   7.8,   8.0,   7.9,  8.7],
  hoahoc: [7.5,  7.8,   7.6,   7.4,   7.7,  6.5],
  tienganh:[7.8, 8.0,   8.1,   8.2,   8.2,  8.5],
  lichsu: [6.5,  6.8,   7.0,   7.2,   7.0,  6.8],
  vatly:  [7.0,  7.2,   7.5,   7.6,   7.5,  7.8],
};

const QUIZ_DATA = [
  { q: 'Khi h·ªçc m·ªôt kh√°i ni·ªám m·ªõi, b·∫°n th∆∞·ªùng l√†m g√¨ ƒë·∫ßu ti√™n?', cat: 'Ti·∫øp nh·∫≠n th√¥ng tin',
    opts: ['ƒê·ªçc s√°ch & ghi ch√∫ chi ti·∫øt', 'Xem video ho·∫∑c nghe gi·∫£i th√≠ch', 'T·ª± l√†m b√†i t·∫≠p th·ª±c h√†nh ngay', 'Th·∫£o lu·∫≠n v·ªõi b·∫°n b√® ho·∫∑c th·∫ßy c√¥'],
    traits: ['visual', 'auditory', 'kinesthetic', 'social'] },
  { q: 'M√¥i tr∆∞·ªùng h·ªçc t·∫≠p l√Ω t∆∞·ªüng c·ªßa b·∫°n l√†?', cat: 'M√¥i tr∆∞·ªùng h·ªçc',
    opts: ['Ph√≤ng y√™n tƒ©nh, h·ªçc m·ªôt m√¨nh', 'Th∆∞ vi·ªán v·ªõi ti·∫øng ·ªìn nh·∫π', 'Qu√°n c√† ph√™ ho·∫∑c ngo√†i tr·ªùi', 'H·ªçc nh√≥m c√πng b·∫°n b√®'],
    traits: ['intro', 'intro', 'ambi', 'extra'] },
  { q: 'Khi g·∫∑p b√†i to√°n kh√≥, b·∫°n th∆∞·ªùng ph·∫£n ·ª©ng nh∆∞ th·∫ø n√†o?', cat: 'Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ',
    opts: ['Ng·ªìi suy nghƒ© m·ªôt m√¨nh cho ƒë·∫øn khi hi·ªÉu', 'T√¨m th√™m t√†i li·ªáu tham kh·∫£o', 'Nh·ªù ng∆∞·ªùi gi·∫£i th√≠ch ngay', 'B·ªè qua, l√†m b√†i kh√°c tr∆∞·ªõc'],
    traits: ['analytical', 'visual', 'social', 'ambi'] },
  { q: 'B·∫°n nh·ªõ th√¥ng tin l√¢u nh·∫•t khi n√†o?', cat: 'K·ªπ nƒÉng ghi nh·ªõ',
    opts: ['T·ª± vi·∫øt tay v√† v·∫Ω s∆° ƒë·ªì', 'Nghe gi·∫£ng nhi·ªÅu l·∫ßn', 'T·ª± ra ƒë·ªÅ ki·ªÉm tra cho m√¨nh', 'Gi·∫£ng l·∫°i cho ng∆∞·ªùi kh√°c'],
    traits: ['visual', 'auditory', 'kinesthetic', 'social'] },
  { q: 'Khung gi·ªù n√†o b·∫°n h·ªçc hi·ªáu qu·∫£ nh·∫•t?', cat: 'Th·ªùi gian h·ªçc',
    opts: ['Bu·ªïi s√°ng s·ªõm (5:30‚Äì8:00)', 'Chi·ªÅu (14:00‚Äì17:00)', 'T·ªëi (20:00‚Äì22:00)', 'ƒê√™m khuya (sau 22:00)'],
    traits: ['morning', 'afternoon', 'evening', 'night'] },
  { q: 'C√°ch b·∫°n qu·∫£n l√Ω th·ªùi gian khi c√≥ nhi·ªÅu b√†i?', cat: 'Qu·∫£n l√Ω th·ªùi gian',
    opts: ['L√™n k·∫ø ho·∫°ch chi ti·∫øt ngay t·ª´ ƒë·∫ßu', 'L√†m ƒë·ªÅu m·ªói ng√†y m·ªôt √≠t', 'T·∫≠p trung cao khi g·∫ßn deadline', 'Tu·ª≥ v√†o t√¢m tr·∫°ng t·ª´ng ng√†y'],
    traits: ['planner', 'steady', 'rusher', 'ambi'] },
  { q: 'ƒêi·ªÉm h·ªçc t·∫≠p m·∫°nh nh·∫•t c·ªßa b·∫°n l√† g√¨?', cat: 'Th·∫ø m·∫°nh h·ªçc t·∫≠p',
    opts: ['T∆∞ duy logic v√† ph√¢n t√≠ch', 'S√°ng t·∫°o, li√™n t∆∞·ªüng phong ph√∫', 'Ghi nh·ªõ nhanh v√† l√¢u', '√Åp d·ª•ng th·ª±c t·∫ø linh ho·∫°t'],
    traits: ['analytical', 'creative', 'memory', 'practical'] },
  { q: 'H√¨nh th·ª©c thi n√†o b·∫°n th√≠ch nh·∫•t?', cat: 'H√¨nh th·ª©c ƒë√°nh gi√°',
    opts: ['T·ª± lu·∫≠n ‚Äî tr√¨nh b√†y s√¢u', 'Tr·∫Øc nghi·ªám ‚Äî nhanh g·ªçn', 'Thuy·∫øt tr√¨nh ho·∫∑c d·ª± √°n', 'B√†i t·∫≠p v·ªÅ nh√† tho·∫£i m√°i'],
    traits: ['essay', 'mcq', 'project', 'homework'] },
  { q: 'Sau bu·ªïi h·ªçc, b·∫°n th∆∞·ªùng √¥n l·∫°i khi n√†o?', cat: 'Th√≥i quen √¥n t·∫≠p',
    opts: ['Ngay sau 30 ph√∫t', 'Sau 1‚Äì2 gi·ªù', 'S√°ng h√¥m sau', 'Ch·ªâ khi s·∫Øp thi'],
    traits: ['immediate', 'delay', 'nextday', 'exam'] },
  { q: 'Ph∆∞∆°ng ph√°p h·ªçc b·∫°n mu·ªën th·ª≠ nh·∫•t l√†?', cat: 'Ph∆∞∆°ng ph√°p',
    opts: ['Pomodoro (25 ph√∫t t·∫≠p trung)', 'Spaced Repetition (flashcard)', 'Feynman (d·∫°y l·∫°i cho ng∆∞·ªùi)', 'Mind Map (s∆° ƒë·ªì t∆∞ duy)'],
    traits: ['pomodoro', 'spaced', 'feynman', 'mindmap'] },
];

const PERSONALITIES = {
  analytical: {
    emoji: 'üî¨', type: 'Nh√† ph√¢n t√≠ch logic',
    desc: 'B·∫°n c√≥ t∆∞ duy h·ªá th·ªëng, gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ t·ª´ng b∆∞·ªõc v√† h·ªçc t·ªët nh·∫•t trong m√¥i tr∆∞·ªùng y√™n tƒ©nh. S·ª©c m·∫°nh l·ªõn nh·∫•t c·ªßa b·∫°n l√† kh·∫£ nƒÉng ph√¢n t√≠ch s√¢u v√† ƒë·ªôc l·∫≠p.',
    strengths: ['T∆∞ duy logic ch·∫∑t ch·∫Ω', 'Kh·∫£ nƒÉng t·∫≠p trung cao', 'H·ªçc ƒë·ªôc l·∫≠p hi·ªáu qu·∫£'],
    improve: ['Th·ªânh tho·∫£ng n√™n h·ªçc nh√≥m', 'Linh ho·∫°t h∆°n v·ªõi ph∆∞∆°ng ph√°p'],
    methods: ['Pomodoro 25/5', 'Spaced Repetition', 'Feynman Technique']
  },
  social: {
    emoji: 'üåü', type: 'Ng∆∞·ªùi h·ªçc x√£ h·ªôi',
    desc: 'B·∫°n h·ªçc t·ªët nh·∫•t khi trao ƒë·ªïi v√† th·∫£o lu·∫≠n. Kh·∫£ nƒÉng giao ti·∫øp v√† gi·∫£i th√≠ch cho ng∆∞·ªùi kh√°c gi√∫p b·∫°n hi·ªÉu s√¢u h∆°n v√† nh·ªõ l√¢u h∆°n.',
    strengths: ['Giao ti·∫øp v√† thuy·∫øt tr√¨nh t·ªët', 'H·ªçc nh√≥m r·∫•t hi·ªáu qu·∫£', 'T∆∞ duy linh ho·∫°t, ƒëa chi·ªÅu'],
    improve: ['C·∫ßn kh√¥ng gian t·∫≠p trung', 'Tr√°nh ph√¢n t√¢m khi h·ªçc m·ªôt m√¨nh'],
    methods: ['Study Buddy', 'Peer Teaching', 'Group Discussion']
  },
  creative: {
    emoji: 'üé®', type: 'T∆∞ duy s√°ng t·∫°o',
    desc: 'B·∫°n k·∫øt n·ªëi th√¥ng tin qua h√¨nh ·∫£nh, m√†u s·∫Øc v√† c√¢u chuy·ªán. Mind Map v√† ghi ch√∫ m√†u s·∫Øc l√† v≈© kh√≠ b√≠ m·∫≠t gi√∫p b·∫°n h·ªçc hi·ªáu qu·∫£ v∆∞·ª£t tr·ªôi.',
    strengths: ['Li√™n t∆∞·ªüng phong ph√∫', 'H·ªçc qua h√¨nh ·∫£nh xu·∫•t s·∫Øc', 'T∆∞ duy s√°ng t·∫°o ƒë·ªôc ƒë√°o'],
    improve: ['C·∫ßn c·∫•u tr√∫c r√µ r√†ng h∆°n', 'Tr√°nh lan man khi h·ªçc'],
    methods: ['Mind Mapping m√†u s·∫Øc', 'Visual Note-taking', 'Story-based Learning']
  },
  default: {
    emoji: 'üéØ', type: 'H·ªçc sinh to√†n di·ªán',
    desc: 'B·∫°n th√≠ch ·ª©ng t·ªët v·ªõi nhi·ªÅu phong c√°ch h·ªçc kh√°c nhau. K·∫øt h·ª£p nhi·ªÅu ph∆∞∆°ng ph√°p v√† ƒëi·ªÅu ch·ªânh theo t·ª´ng m√¥n h·ªçc s·∫Ω mang l·∫°i k·∫øt qu·∫£ t·ªët nh·∫•t.',
    strengths: ['Th√≠ch ·ª©ng linh ho·∫°t', 'Ph√π h·ª£p nhi·ªÅu m√¥i tr∆∞·ªùng', 'C√¢n b·∫±ng nhi·ªÅu k·ªπ nƒÉng'],
    improve: ['X√°c ƒë·ªãnh m·ªôt phong c√°ch ch√≠nh', 'X√¢y d·ª±ng th√≥i quen ·ªïn ƒë·ªãnh'],
    methods: ['K·∫øt h·ª£p Pomodoro + Flashcard', 'Thay ƒë·ªïi m√¥i tr∆∞·ªùng h·ªçc']
  }
};

const EXAM_BANK = {
  'H√≥a h·ªçc': [
    { q: 'H·ª£p ch·∫•t n√†o sau ƒë√¢y thu·ªôc lo·∫°i este?', opts: ['CH‚ÇÉCOOH', 'CH‚ÇÉCOOC‚ÇÇH‚ÇÖ', 'C‚ÇÇH‚ÇÖOH', 'CH‚ÇÉCHO'], ans: 1, exp: 'Este c√≥ c√¥ng th·ª©c R-COO-R\'. CH‚ÇÉCOOC‚ÇÇH‚ÇÖ (ethyl acetate) l√† este ƒëi·ªÉn h√¨nh.' },
    { q: 'Ph·∫£n ·ª©ng th·ªßy ph√¢n este trong m√¥i tr∆∞·ªùng NaOH g·ªçi l√†:', opts: ['Este h√≥a', 'X√† ph√≤ng h√≥a', 'Oxi h√≥a', 'Trung h√≤a axit'], ans: 1, exp: 'X√† ph√≤ng h√≥a = th·ªßy ph√¢n este trong m√¥i tr∆∞·ªùng ki·ªÅm, t·∫°o mu·ªëi + ancol.' },
    { q: 'C√¥ng th·ª©c ph√¢n t·ª≠ c·ªßa Glucoz∆° l√†:', opts: ['C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÖ', 'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ', 'C‚ÇÅ‚ÇÇH‚ÇÇ‚ÇÇO‚ÇÅ‚ÇÅ', 'C‚ÇÜH‚ÇÅ‚ÇÄO‚ÇÖ'], ans: 1, exp: 'Glucoz∆°: C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ ‚Äî monosaccharide, aldehyde.' },
    { q: 'Kim lo·∫°i ph·∫£n ·ª©ng m·∫°nh nh·∫•t v·ªõi n∆∞·ªõc ·ªü nhi·ªát ƒë·ªô th∆∞·ªùng:', opts: ['Fe', 'Cu', 'Na', 'Al'], ans: 2, exp: '2Na + 2H‚ÇÇO ‚Üí 2NaOH + H‚ÇÇ‚Üë. Na l√† kim lo·∫°i ki·ªÅm r·∫•t ho·∫°t ƒë·ªông.' },
    { q: 'Ph·∫£n ·ª©ng Fe + 2HCl ‚Üí FeCl‚ÇÇ + H‚ÇÇ‚Üë l√† lo·∫°i ph·∫£n ·ª©ng:', opts: ['Trao ƒë·ªïi', 'Th·∫ø', 'Ph√¢n h·ªßy', 'H√≥a h·ª£p'], ans: 1, exp: 'Ph·∫£n ·ª©ng th·∫ø: Fe thay th·∫ø H trong ph√¢n t·ª≠ axit HCl.' },
    { q: 'Dung d·ªãch NaOH c√≥ gi√° tr·ªã pH:', opts: ['pH < 7', 'pH = 7', 'pH > 7', 'Kh√¥ng x√°c ƒë·ªãnh'], ans: 2, exp: 'NaOH l√† baz∆° m·∫°nh, pH > 7 (m√¥i tr∆∞·ªùng ki·ªÅm).' },
    { q: 'T√™n g·ªçi c·ªßa CH‚ÇÉ-NH‚ÇÇ l√†:', opts: ['Etylamin', 'Metylamin', 'ƒêimetylamin', 'Anilin'], ans: 1, exp: 'CH‚ÇÉ-NH‚ÇÇ = metylamin, amin b·∫≠c m·ªôt ƒë∆°n gi·∫£n nh·∫•t.' },
    { q: 'Protein b·ªã ƒë√¥ng t·ª• b·ªüi nhi·ªát do:', opts: ['Ph√° v·ª° li√™n k·∫øt peptide', 'Ph√° v·ª° c·∫•u tr√∫c b·∫≠c cao', 'Th·ªßy ph√¢n protein', 'Oxi h√≥a axit amin'], ans: 1, exp: 'Nhi·ªát ph√° v·ª° c·∫•u tr√∫c b·∫≠c 2, 3, 4 ‚Üí protein ƒë√¥ng t·ª• (bi·∫øn t√≠nh).' },
    { q: 'Tr√πng h·ª£p CH‚ÇÇ=CHCl t·∫°o ra polyme:', opts: ['PE', 'PVC', 'PP', 'PS'], ans: 1, exp: 'PVC (polyvinyl chloride) = tr√πng h·ª£p vinyl clorua CH‚ÇÇ=CHCl.' },
    { q: 'Kim lo·∫°i kh√¥ng ph·∫£n ·ª©ng v·ªõi dung d·ªãch HCl lo√£ng:', opts: ['Fe', 'Mg', 'Cu', 'Zn'], ans: 2, exp: 'Cu ƒë·ª©ng sau H trong d√£y ho·∫°t ƒë·ªông h√≥a h·ªçc ‚Üí kh√¥ng t√°c d·ª•ng HCl lo√£ng.' },
  ],
  'To√°n': [
    { q: 'ƒê·∫°o h√†m c·ªßa f(x) = x¬≥ ‚Äì 3x¬≤ + 2x l√†:', opts: ['3x¬≤ ‚Äì 6x + 2', '3x¬≤ ‚Äì 6x', 'x¬≤ ‚Äì 6x + 2', '3x ‚Äì 6'], ans: 0, exp: "f'(x) = 3x¬≤ ‚Äì 6x + 2 (√°p d·ª•ng c√¥ng th·ª©c ƒë·∫°o h√†m)." },
    { q: 'lim(x‚Üí2) (x¬≤ ‚Äì 4)/(x ‚Äì 2) b·∫±ng:', opts: ['0', '2', '4', '‚àû'], ans: 2, exp: '(x¬≤‚Äì4)/(x‚Äì2) = (x‚Äì2)(x+2)/(x‚Äì2) = x+2 ‚Üí 2+2 = 4.' },
    { q: 'T·∫≠p nghi·ªám c·ªßa |x ‚Äì 1| ‚â§ 3:', opts: ['[‚Äì2, 4]', '(‚Äì2, 4)', '[1, 4]', '[‚Äì4, 2]'], ans: 0, exp: '‚Äì3 ‚â§ x‚Äì1 ‚â§ 3 ‚Üí ‚Äì2 ‚â§ x ‚â§ 4 ‚Üí t·∫≠p nghi·ªám [‚Äì2, 4].' },
    { q: 'Gi√° tr·ªã c·ªßa log‚ÇÇ(32) l√†:', opts: ['4', '5', '6', '16'], ans: 1, exp: '2‚Åµ = 32 ‚Üí log‚ÇÇ(32) = 5.' },
    { q: 'Th·ªÉ t√≠ch h√¨nh c·∫ßu b√°n k√≠nh R:', opts: ['4œÄR¬≤', '(4/3)œÄR¬≥', '2œÄR¬≥', 'œÄR¬≥'], ans: 1, exp: 'V = (4/3)œÄR¬≥ ‚Äî c√¥ng th·ª©c th·ªÉ t√≠ch h√¨nh c·∫ßu.' },
    { q: 'S·ªë nghi·ªám c·ªßa ph∆∞∆°ng tr√¨nh 2^x = 8:', opts: ['x = 2', 'x = 3', 'x = 4', 'V√¥ nghi·ªám'], ans: 1, exp: '2^x = 2¬≥ ‚Üí x = 3.' },
    { q: 'T√≠ch ph√¢n ‚à´(2x + 1)dx =', opts: ['x¬≤ + x + C', 'x¬≤ + C', '2x¬≤ + x + C', 'x + C'], ans: 0, exp: '‚à´(2x+1)dx = x¬≤ + x + C.' },
    { q: 'C·∫•p s·ªë c·ªông u‚ÇÅ=2, d=3. S·ªë h·∫°ng t·ªïng qu√°t u‚Çô =', opts: ['3n+2', '3n‚Äì1', '2n+3', 'n+2'], ans: 1, exp: 'u‚Çô = u‚ÇÅ + (n‚Äì1)d = 2 + 3(n‚Äì1) = 3n‚Äì1.' },
    { q: 'G√≥c gi·ªØa a‚Éó=(1,0) v√† b‚Éó=(0,1) l√†:', opts: ['0¬∞', '45¬∞', '90¬∞', '180¬∞'], ans: 2, exp: 'a‚Éó¬∑b‚Éó = 0 ‚Üí cos Œ∏ = 0 ‚Üí Œ∏ = 90¬∞.' },
    { q: 'P(tung ƒë·ªìng xu 2 l·∫ßn ƒë·ªÅu ra ng·ª≠a) =', opts: ['1/2', '1/3', '1/4', '2/3'], ans: 2, exp: 'P = (1/2)¬≤ = 1/4.' },
  ],
  'V·∫≠t l√Ω': [
    { q: 'C√¥ng th·ª©c t√≠nh v·∫≠n t·ªëc trong chuy·ªÉn ƒë·ªông ƒë·ªÅu:', opts: ['v = a¬∑t', 'v = s/t', 'v = s¬∑t', 'v = a/t'], ans: 1, exp: 'v = s/t (qu√£ng ƒë∆∞·ªùng / th·ªùi gian).' },
    { q: 'L·ª±c h·∫•p d·∫´n gi·ªØa 2 v·∫≠t t·ªâ l·ªá v·ªõi:', opts: ['Kho·∫£ng c√°ch r', '1/r¬≤', 'r¬≤', '1/r'], ans: 1, exp: 'F = Gm‚ÇÅm‚ÇÇ/r¬≤ ‚Äî l·ª±c t·ªâ l·ªá ngh·ªãch v·ªõi b√¨nh ph∆∞∆°ng kho·∫£ng c√°ch.' },
    { q: 'ƒê∆°n v·ªã ƒëo ƒëi·ªán tr·ªü trong h·ªá SI:', opts: ['Ampe (A)', 'V√¥n (V)', '√îm (Œ©)', 'O√°t (W)'], ans: 2, exp: 'ƒêi·ªán tr·ªü ƒëo b·∫±ng √îm (Œ©), theo ƒë·ªãnh lu·∫≠t Ohm: R = U/I.' },
    { q: 'V·∫≠n t·ªëc √°nh s√°ng trong ch√¢n kh√¥ng ‚âà', opts: ['3√ó10‚Å∂ m/s', '3√ó10‚Å∏ m/s', '3√ó10¬π‚Å∞ m/s', '3√ó10‚Å¥ m/s'], ans: 1, exp: 'c ‚âà 3√ó10‚Å∏ m/s ‚Äî h·∫±ng s·ªë v≈© tr·ª• quan tr·ªçng.' },
    { q: 'C√¥ng th·ª©c ƒë·ªông nƒÉng c·ªßa v·∫≠t:', opts: ['Wƒë = mgh', 'Wƒë = ¬Ωmv¬≤', 'Wƒë = Fs', 'Wƒë = mv'], ans: 1, exp: 'Wƒë = ¬Ωmv¬≤ ‚Äî ph·ª• thu·ªôc v√†o v·∫≠n t·ªëc v√† kh·ªëi l∆∞·ª£ng.' },
    { q: 'Hi·ªán t∆∞·ª£ng c·ªông h∆∞·ªüng x·∫£y ra khi:', opts: ['f_ngo√†i = 0', 'f_ngo√†i = f_ri√™ng', 'f_ngo√†i > f_ri√™ng', 'f_ngo√†i < f_ri√™ng'], ans: 1, exp: 'C·ªông h∆∞·ªüng khi t·∫ßn s·ªë c∆∞·ª°ng b·ª©c = t·∫ßn s·ªë ri√™ng c·ªßa h·ªá.' },
    { q: 'Tia X c√≥ b∆∞·ªõc s√≥ng:', opts: ['D√†i h∆°n tia UV', 'D√†i h∆°n tia h·ªìng ngo·∫°i', 'Ng·∫Øn h∆°n tia UV', 'B·∫±ng √°nh s√°ng kh·∫£ ki·∫øn'], ans: 2, exp: 'Tia X: Œª ‚âà 10‚Åª¬π¬π‚Äì10‚Åª‚Å∏ m, ng·∫Øn h∆°n tia UV.' },
    { q: 'NƒÉng l∆∞·ª£ng photon: Œµ = hf. h l√† h·∫±ng s·ªë:', opts: ['Boltzmann', 'Avogadro', 'Planck', 'Faraday'], ans: 2, exp: 'h = h·∫±ng s·ªë Planck ‚âà 6.626√ó10‚Åª¬≥‚Å¥ J¬∑s.' },
    { q: 'ƒê∆°n v·ªã ƒëo ƒëi·ªán dung t·ª• ƒëi·ªán:', opts: ['Henry (H)', 'Farad (F)', 'Weber (Wb)', 'Tesla (T)'], ans: 1, exp: 'ƒêi·ªán dung C ƒëo b·∫±ng Farad (F).' },
    { q: 'L·ª±c t·ª´ t√°c d·ª•ng l√™n d√¢y d·∫´n mang d√≤ng ƒëi·ªán:', opts: ['F = qE', 'F = BIl sinŒ±', 'F = mv¬≤/r', 'F = kq‚ÇÅq‚ÇÇ/r¬≤'], ans: 1, exp: 'F = BIl sinŒ± ‚Äî l·ª±c Ampere t√°c d·ª•ng l√™n ƒëo·∫°n d√¢y c√≥ d√≤ng ƒëi·ªán.' },
  ],
  'Ti·∫øng Anh': [
    { q: 'She _____ to school every day. (hi·ªán t·∫°i ƒë∆°n)', opts: ['go', 'goes', 'going', 'gone'], ans: 1, exp: '"She" d√πng v·ªõi V-s/es ·ªü hi·ªán t·∫°i ƒë∆°n ‚Üí "goes".' },
    { q: 'Passive: "They built this bridge in 1990."', opts: ['This bridge is built in 1990.', 'This bridge was built in 1990.', 'This bridge has been built in 1990.', 'This bridge had been built in 1990.'], ans: 1, exp: 'Qu√° kh·ª© ƒë∆°n b·ªã ƒë·ªông: was/were + V3 ‚Üí was built.' },
    { q: '"Diligent" c√≥ nghƒ©a g·∫ßn nh·∫•t v·ªõi:', opts: ['lazy', 'hardworking', 'careless', 'reckless'], ans: 1, exp: 'Diligent = chƒÉm ch·ªâ, c·∫ßn c√π = hardworking.' },
    { q: 'Conditional 1: "If it rains, I _____ stay home."', opts: ['will', 'would', 'should', 'can'], ans: 0, exp: 'If + present simple, will + V ‚Äî ƒëi·ªÅu ki·ªán lo·∫°i 1.' },
    { q: '"Under the weather" c√≥ nghƒ©a l√†:', opts: ['·ªû ngo√†i tr·ªùi', 'C·∫£m th·∫•y kh√¥ng kh·ªèe', 'Th·ªùi ti·∫øt x·∫•u', 'Lo l·∫Øng'], ans: 1, exp: 'Idiom: "under the weather" = feeling ill/sick.' },
    { q: 'Comparative c·ªßa "good" l√†:', opts: ['gooder', 'more good', 'better', 'best'], ans: 2, exp: 'good ‚Üí better ‚Üí best (b·∫•t quy t·∫Øc).' },
    { q: '"Although" d√πng ƒë·ªÉ di·ªÖn ƒë·∫°t:', opts: ['Nguy√™n nh√¢n', 'S·ª± ƒë·ªëi l·∫≠p', 'ƒêi·ªÅu ki·ªán', 'M·ª•c ƒë√≠ch'], ans: 1, exp: 'Although = m·∫∑c d√π ‚Üí di·ªÖn ƒë·∫°t s·ª± t∆∞∆°ng ph·∫£n, ƒë·ªëi l·∫≠p.' },
    { q: 'C√¢u gi√°n ti·∫øp: He said "I am tired." ‚Üí He said that _____.', opts: ['he is tired', 'he was tired', 'he were tired', 'he be tired'], ans: 1, exp: 'Reported speech: am ‚Üí was (l√πi th√¨).' },
    { q: 'Ch·ªçn c√¢u ƒë√∫ng ng·ªØ ph√°p:', opts: ['I have went there yesterday.', 'I went there yesterday.', 'I have go there yesterday.', 'I goes there yesterday.'], ans: 1, exp: '"Yesterday" d√πng v·ªõi qu√° kh·ª© ƒë∆°n ‚Üí "went".' },
    { q: 'T·ª´ n√†o l√† t√≠nh t·ª´ (adjective)?', opts: ['quickly', 'beauty', 'beautiful', 'beautify'], ans: 2, exp: 'beautiful = t√≠nh t·ª´; quickly = tr·∫°ng t·ª´; beauty = danh t·ª´; beautify = ƒë·ªông t·ª´.' },
  ],
  'Ng·ªØ vƒÉn': [
    { q: '"V·ª£ ch·ªìng A Ph·ªß" l√† t√°c ph·∫©m c·ªßa ai?', opts: ['Nguy·ªÖn Tu√¢n', 'T√¥ Ho√†i', 'Nam Cao', 'Kim L√¢n'], ans: 1, exp: 'T√¥ Ho√†i vi·∫øt "V·ª£ ch·ªìng A Ph·ªß" (1952) sau chuy·∫øn ƒëi T√¢y B·∫Øc.' },
    { q: 'B√†i th∆° "ƒê·ªìng ch√≠" c·ªßa Ch√≠nh H·ªØu s√°ng t√°c nƒÉm:', opts: ['1946', '1948', '1950', '1954'], ans: 1, exp: '"ƒê·ªìng ch√≠" ƒë∆∞·ª£c vi·∫øt nƒÉm 1948, sau chi·∫øn d·ªãch Vi·ªát B·∫Øc.' },
    { q: '"T·∫Øt ƒë√®n" l√† t√°c ph·∫©m c·ªßa:', opts: ['V≈© Tr·ªçng Ph·ª•ng', 'Ng√¥ T·∫•t T·ªë', 'Nam Cao', 'Nguy·ªÖn C√¥ng Hoan'], ans: 1, exp: '"T·∫Øt ƒë√®n" (1937) ‚Äî Ng√¥ T·∫•t T·ªë, ph·∫£n √°nh hi·ªán th·ª±c n√¥ng th√¥n.' },
    { q: 'B√†i th∆° "S√≥ng" l√† c·ªßa t√°c gi·∫£ n√†o?', opts: ['Xu√¢n Di·ªáu', 'Huy C·∫≠n', 'Xu√¢n Qu·ª≥nh', 'Ch·∫ø Lan Vi√™n'], ans: 2, exp: '"S√≥ng" ‚Äî Xu√¢n Qu·ª≥nh (1967), b√†i th∆° t√¨nh n·ªïi ti·∫øng.' },
    { q: '"Truy·ªán Ki·ªÅu" c·ªßa Nguy·ªÖn Du thu·ªôc th·ªÉ lo·∫°i:', opts: ['Th∆° t·ª© tuy·ªát', 'Truy·ªán th∆° N√¥m', 'Chi·∫øu', 'Ph√∫'], ans: 1, exp: '"Truy·ªán Ki·ªÅu" l√† truy·ªán th∆° N√¥m g·ªìm 3254 c√¢u l·ª•c b√°t.' },
    { q: 'Ph√©p tu t·ª´ trong c√¢u "M·∫∑t tr·ªùi c·ªßa b·∫Øp th√¨ n·∫±m tr√™n ƒë·ªìi" l√†:', opts: ['So s√°nh', 'Nh√¢n h√≥a', '·∫®n d·ª•', 'ƒêi·ªáp ng·ªØ'], ans: 2, exp: '"M·∫∑t tr·ªùi" ƒë∆∞·ª£c d√πng theo nghƒ©a ·∫©n d·ª• ƒë·ªÉ ch·ªâ ƒëi·ªÅu cao qu√Ω.' },
    { q: 'Nh√¢n v·∫≠t Ch√≠ Ph√®o k·∫øt th√∫c cu·ªôc ƒë·ªùi nh∆∞ th·∫ø n√†o?', opts: ['ƒê∆∞·ª£c c·∫£i t·∫°o, tr·ªü th√†nh ng∆∞·ªùi t·ªët', 'Gi·∫øt B√° Ki·∫øn r·ªìi t·ª± t·ª≠', 'B·ªè l√†ng ra ƒëi', 'K·∫øt h√¥n v·ªõi Th·ªã N·ªü'], ans: 1, exp: 'Ch√≠ Ph√®o gi·∫øt B√° Ki·∫øn r·ªìi t·ª± v·∫´n ‚Äî bi k·ªãch kh√¥ng tho√°t ra ƒë∆∞·ª£c.' },
    { q: '"M·∫∑t ƒë∆∞·ªùng kh√°t v·ªçng" l√† tr∆∞·ªùng ca c·ªßa:', opts: ['T·ªë H·ªØu', 'Nguy·ªÖn Khoa ƒêi·ªÅm', 'Huy C·∫≠n', 'Xu√¢n Di·ªáu'], ans: 1, exp: 'Nguy·ªÖn Khoa ƒêi·ªÅm ‚Äî tr∆∞·ªùng ca th·ªùi k·ª≥ ch·ªëng M·ªπ.' },
    { q: '"Nam qu·ªëc s∆°n h√†" ƒë∆∞·ª£c coi l√† b·∫£n tuy√™n ng√¥n ƒë·ªôc l·∫≠p th·ª© m·∫•y?', opts: ['Th·ª© nh·∫•t', 'Th·ª© hai', 'Th·ª© ba', 'Th·ª© t∆∞'], ans: 0, exp: '"Nam qu·ªëc s∆°n h√†" (TK XI) ‚Äî tuy√™n ng√¥n ƒë·ªôc l·∫≠p ƒë·∫ßu ti√™n.' },
    { q: 'T√°c ph·∫©m "Chi·∫øc thuy·ªÅn ngo√†i xa" c·ªßa ai?', opts: ['Nguy·ªÖn Minh Ch√¢u', 'Ma VƒÉn Kh√°ng', 'Nguy·ªÖn Kh·∫£i', 'B·∫£o Ninh'], ans: 0, exp: '"Chi·∫øc thuy·ªÅn ngo√†i xa" ‚Äî Nguy·ªÖn Minh Ch√¢u, vi·∫øt v·ªÅ ngh·ªãch l√Ω cu·ªôc s·ªëng.' },
  ],
};

// =====================================================
// APP STATE
// =====================================================
const APP = {
  user: { name: 'Nguy·ªÖn VƒÉn An', grade: '12' },
  quizIndex: 0,
  quizAnswers: [],
  examDiff: 'medium',
  examData: [],
  examAnswers: {},
  examTimer: null,
  examTimeLeft: 0,
  charts: {},
  simChart: null,
};

// =====================================================
// UTILITIES
// =====================================================
function scoreColor(s) {
  if (s >= 8.5) return '#10c98a';
  if (s >= 7.0) return '#667eea';
  if (s >= 5.5) return '#fdcb6e';
  return '#f5576c';
}
function scoreGrad(s) {
  if (s >= 8.5) return 'linear-gradient(135deg,#43e97b,#38f9d7)';
  if (s >= 7.0) return 'linear-gradient(135deg,#667eea,#764ba2)';
  if (s >= 5.5) return 'linear-gradient(135deg,#ffecd2,#fcb69f)';
  return 'linear-gradient(135deg,#f093fb,#f5576c)';
}

function showToast(msg, type = 'success') {
  const icons = { success: '‚úÖ', error: '‚ùå', warn: '‚ö†Ô∏è', info: 'üí°' };
  const colors = { success: '#10c98a', error: '#f5576c', warn: '#fdcb6e', info: '#667eea' };
  const el = document.createElement('div');
  el.className = 'toast';
  el.style.borderLeft = `3px solid ${colors[type] || colors.success}`;
  el.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => { el.style.opacity = '0'; el.style.transform = 'translateX(20px)'; el.style.transition = '0.3s'; setTimeout(() => el.remove(), 300); }, 3200);
}

// =====================================================
// AUTH
// =====================================================
function authSwitchTab(type, el) {
  document.querySelectorAll('#auth-tabs .tab-pill').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('login-form').style.display = type === 'login' ? 'block' : 'none';
  document.getElementById('register-form').style.display = type === 'register' ? 'block' : 'none';
}

function handleLogin() {
  APP.user.name = document.getElementById('login-name').value.trim() || 'Nguy·ªÖn VƒÉn An';
  APP.user.grade = document.getElementById('login-grade').value;
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('main-app').style.display = 'block';
  // Update sidebar
  const av = APP.user.name.charAt(0).toUpperCase();
  document.getElementById('sb-avatar').textContent = av;
  document.getElementById('sb-pname').textContent = APP.user.name;
  const level = parseInt(APP.user.grade) <= 9 ? 'THCS' : 'THPT';
  document.getElementById('sb-pgrade').textContent = `L·ªõp ${APP.user.grade} ¬∑ ${level}`;
  document.getElementById('dash-subtitle').textContent = `L·ªõp ${APP.user.grade} ¬∑ H·ªçc k·ª≥ 2 ¬∑ NƒÉm h·ªçc 2025‚Äì2026`;
  initApp();
}

function handleLogout() {
  document.getElementById('main-app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('login-screen').style.alignItems = 'center';
  document.getElementById('login-screen').style.justifyContent = 'center';
}

// =====================================================
// NAVIGATION
// =====================================================
function navigate(el) {
  if (!el) return;
  const sid = el.dataset.screen;
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + sid).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  closeMobileMenu();
}

function toggleMobileMenu() {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
}
function closeMobileMenu() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
}

// =====================================================
// INIT
// =====================================================
function initApp() {
  buildDashAlerts();
  buildDashStats();
  buildDashSubjects();
  buildDashGoals();
  buildSubjectInputGrid();
  buildWeakStrongBlocks();
  buildAIDefaultBlocks();
  buildPredictRings();
  buildProbBars();
  buildRoadmap();
  buildSchedule();
  buildProgressStats();
  buildCompareTable();
  buildAlerts();
  initQuiz();
  initSimulation();
  setTimeout(initCharts, 150);
}

// =====================================================
// DASHBOARD
// =====================================================
function buildDashAlerts() {
  const drops = SUBJECTS.filter(s => s.score < s.prev);
  let html = drops.map(s => `
    <div class="alert alert-danger">
      <div class="alert-icon">‚ö†Ô∏è</div>
      <div class="alert-body">
        <strong>${s.emoji} ${s.name} gi·∫£m ${(s.prev - s.score).toFixed(1)} ƒëi·ªÉm!</strong>
        <p>T·ª´ ${s.prev} ‚Üí ${s.score}. AI g·ª£i √Ω tƒÉng c∆∞·ªùng √¥n luy·ªán ngay tu·∫ßn n√†y!</p>
      </div>
    </div>`).join('');

  const gains = SUBJECTS.filter(s => s.score >= 8.5 && s.score > s.prev);
  if (gains.length) {
    html += `<div class="alert alert-success">
      <div class="alert-icon">üéâ</div>
      <div class="alert-body">
        <strong>${gains[0].emoji} ${gains[0].name} ƒëang ti·∫øn b·ªô xu·∫•t s·∫Øc!</strong>
        <p>T·ª´ ${gains[0].prev} ‚Üí ${gains[0].score}. Ch·ªâ c√≤n ${(gains[0].target - gains[0].score).toFixed(1)} ƒëi·ªÉm ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u!</p>
      </div>
    </div>`;
  }
  document.getElementById('dash-alerts-container').innerHTML = html;
}

function buildDashStats() {
  const gpa = (SUBJECTS.reduce((a, s) => a + s.score, 0) / SUBJECTS.length).toFixed(1);
  const prevGpa = (SUBJECTS.reduce((a, s) => a + s.prev, 0) / SUBJECTS.length).toFixed(1);
  const diff = (parseFloat(gpa) - parseFloat(prevGpa)).toFixed(1);
  const weakest = [...SUBJECTS].sort((a, b) => a.score - b.score)[0];
  const data = [
    { icon: 'üìä', label: 'GPA Th√°ng 2', val: gpa, change: `${diff >= 0 ? '‚ñ≤ +' : '‚ñº '}${diff} ƒëi·ªÉm`, cls: diff >= 0 ? 'change-up' : 'change-dn', grad: 'var(--grad-primary)' },
    { icon: 'üéØ', label: 'M·ª•c ti√™u To√°n', val: '8.7', change: '‚ñ≤ C√≤n 0.3pt ‚Üí 9.0', cls: 'change-up', grad: 'var(--grad-mint)' },
    { icon: 'üìâ', label: 'M√¥n y·∫øu nh·∫•t', val: weakest.score, change: `‚ñº ${weakest.name} (‚Äì${(weakest.prev - weakest.score).toFixed(1)})`, cls: 'change-dn', grad: 'var(--grad-danger)' },
    { icon: '‚úÖ', label: 'Nhi·ªám v·ª• tu·∫ßn', val: '7/12', change: 'üìå 58% ho√†n th√†nh', cls: 'change-nu', grad: 'var(--grad-warn)' },
  ];
  document.getElementById('dash-stat-cards').innerHTML = data.map(d => `
    <div class="stat-card">
      <div class="stat-card-accent" style="background:${d.grad}"></div>
      <div class="stat-icon" style="background:${d.grad}">
        <span style="font-size:20px">${d.icon}</span>
      </div>
      <div class="stat-label">${d.label}</div>
      <div class="stat-value">${d.val}</div>
      <div class="stat-change ${d.cls}">${d.change}</div>
    </div>`).join('');
}

function buildDashSubjects() {
  document.getElementById('dash-subjects').innerHTML = SUBJECTS.map(s => {
    const ch = s.score - s.prev;
    const pct = (s.score / 10 * 100).toFixed(0);
    return `
      <div style="margin-bottom:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:5px">
          <div style="font-size:13.5px;font-weight:700;display:flex;align-items:center;gap:6px">${s.emoji} ${s.name}</div>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:11px;font-weight:700;color:${ch >= 0 ? 'var(--success)' : 'var(--danger)'}">${ch >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(ch).toFixed(1)}</span>
            <span style="font-family:var(--font-display);font-size:14px;font-weight:800;color:${scoreColor(s.score)}">${s.score}</span>
          </div>
        </div>
        <div class="progress-wrap" style="height:7px">
          <div class="progress-fill" style="width:${pct}%;background:${scoreGrad(s.score)}"></div>
        </div>
      </div>`;
  }).join('');
}

function buildDashGoals() {
  document.getElementById('dash-goals').innerHTML = SUBJECTS.slice(0, 6).map(s => {
    const pct = Math.min(100, (s.score / s.target * 100)).toFixed(0);
    return `
      <div style="margin-bottom:14px">
        <div style="display:flex;justify-content:space-between;margin-bottom:6px">
          <div style="font-size:13.5px;font-weight:600">${s.emoji} ${s.name}</div>
          <div style="font-size:13px;color:var(--ink-3)">${s.score} <span style="color:var(--ink-4)">/ ${s.target}</span></div>
        </div>
        <div class="progress-wrap" style="height:10px">
          <div class="progress-fill" style="width:${pct}%;background:${parseInt(pct) >= 100 ? 'var(--grad-success)' : parseInt(pct) >= 80 ? 'var(--grad-primary)' : 'var(--grad-warn)'}"></div>
        </div>
        <div style="font-size:11px;color:var(--ink-4);margin-top:3px">${pct}% m·ª•c ti√™u</div>
      </div>`;
  }).join('');
}

// =====================================================
// SCORES
// =====================================================
function buildSubjectInputGrid() {
  document.getElementById('subject-input-grid').innerHTML = SUBJECTS.map((s, i) => `
    <div class="subject-card">
      <div class="subject-card-head">
        <div class="subject-name">${s.emoji} ${s.name}</div>
        <div style="width:10px;height:10px;border-radius:50%;background:${scoreColor(s.score)}"></div>
      </div>
      <input class="subject-score-input" type="number" id="inp-${i}"
        value="${s.score}" min="0" max="10" step="0.1"
        oninput="updateSubjScore(${i}, this.value)">
      <div class="progress-wrap" style="height:4px;margin-top:8px">
        <div class="progress-fill" id="sinp-bar-${i}" style="width:${s.score * 10}%;background:${scoreGrad(s.score)}"></div>
      </div>
      <div style="font-size:11px;color:var(--ink-3);margin-top:6px;font-weight:600">M·ª•c ti√™u: ${s.target}</div>
    </div>`).join('');
}

function updateSubjScore(i, v) {
  const val = Math.min(10, Math.max(0, parseFloat(v) || 0));
  SUBJECTS[i].score = val;
  const bar = document.getElementById('sinp-bar-' + i);
  if (bar) { bar.style.width = val * 10 + '%'; bar.style.background = scoreGrad(val); }
}

function saveScores() {
  showToast('‚úÖ ƒê√£ l∆∞u ƒëi·ªÉm! ƒêang c·∫≠p nh·∫≠t AI...', 'success');
  buildDashAlerts(); buildDashStats(); buildDashSubjects(); buildDashGoals();
  buildWeakStrongBlocks(); buildPredictRings(); buildProbBars();
  setTimeout(() => { rebuildCharts(); }, 150);
}

function updateScorePeriod(v) {
  document.getElementById('score-period').textContent = v;
}

function setGoal() {
  const sub = document.getElementById('goal-subject').value;
  const sc = document.getElementById('goal-score-val').value;
  const dl = document.getElementById('goal-deadline').value;
  document.getElementById('goal-confirm-msg').innerHTML = `
    <div class="alert alert-success" style="padding:8px 12px;margin:0">
      <div class="alert-icon" style="font-size:14px">üéØ</div>
      <div class="alert-body"><strong>${sub}: ${sc} ƒëi·ªÉm ¬∑ ${dl}</strong></div>
    </div>`;
  showToast(`üéØ M·ª•c ti√™u ${sub} ‚Üí ${sc} ƒëi·ªÉm ƒë√£ ƒë∆∞·ª£c l∆∞u!`, 'success');
}

// =====================================================
// ANALYSIS
// =====================================================
function buildWeakStrongBlocks() {
  const sorted = [...SUBJECTS].sort((a, b) => a.score - b.score);
  const weak = sorted.slice(0, 3);
  const strong = sorted.slice(-3).reverse();

  document.getElementById('weak-blocks').innerHTML = weak.map(s => `
    <div class="analysis-block" style="border-left-color:${scoreColor(s.score)}">
      <div class="analysis-block-title" style="color:${scoreColor(s.score)}">${s.emoji} ${s.name} ‚Äî ${s.score}/10</div>
      <div class="analysis-block-body">C·∫ßn c·∫£i thi·ªán th√™m ${(s.target - s.score).toFixed(1)} ƒëi·ªÉm ƒë·ªÉ ƒë·∫°t m·ª•c ti√™u ${s.target}. 
      ${s.score < s.prev ? `Gi·∫£m ${(s.prev - s.score).toFixed(1)} so v·ªõi th√°ng tr∆∞·ªõc ‚Äî c·∫ßn h√†nh ƒë·ªông ngay!` : 'ƒêang gi·ªØ ·ªïn ƒë·ªãnh, c·∫ßn tƒÉng t·ªëc.'}</div>
    </div>`).join('');

  document.getElementById('strong-blocks').innerHTML = strong.map(s => `
    <div class="analysis-block" style="border-left-color:${scoreColor(s.score)}">
      <div class="analysis-block-title" style="color:${scoreColor(s.score)}">${s.emoji} ${s.name} ‚Äî ${s.score}/10</div>
      <div class="analysis-block-body">${s.score > s.prev ? `C·∫£i thi·ªán t·ªët (+${(s.score - s.prev).toFixed(1)})! ` : ''}C√≤n ${(s.target - s.score).toFixed(1)} ƒëi·ªÉm ƒë·∫øn m·ª•c ti√™u ${s.target}. Duy tr√¨ nh·ªãp ƒë·ªô hi·ªán t·∫°i.</div>
    </div>`).join('');
}

function buildAIDefaultBlocks() {
  const gpa = (SUBJECTS.reduce((a, s) => a + s.score, 0) / SUBJECTS.length).toFixed(1);
  document.getElementById('ai-default-blocks').innerHTML = `
    <div class="analysis-block" style="border-left-color:var(--accent)">
      <div class="analysis-block-title">üìä Ph√¢n nh√≥m nƒÉng l·ª±c (K-Means Clustering)</div>
      <div class="analysis-block-body">GPA ${gpa} ‚Äî B·∫°n thu·ªôc nh√≥m <strong>"H·ªçc sinh ti·ªÅm nƒÉng cao"</strong>. 72% h·ªçc sinh c√πng nh√≥m ƒë·∫°t m·ª•c ti√™u trong 8 tu·∫ßn khi h·ªçc ƒë√∫ng ph∆∞∆°ng ph√°p.</div>
    </div>
    <div class="analysis-block" style="border-left-color:var(--warn)">
      <div class="analysis-block-title">‚ö° Xu h∆∞·ªõng ƒëi·ªÉm (Linear Regression)</div>
      <div class="analysis-block-body">T·ªëc ƒë·ªô c·∫£i thi·ªán To√°n: +0.3/th√°ng ‚Üí D·ª± ƒëo√°n ƒë·∫°t 9.0 v√†o <strong>th√°ng 4/2026</strong>. Th√™m 2 bu·ªïi/tu·∫ßn c√≥ th·ªÉ s·ªõm h∆°n 3 tu·∫ßn.</div>
    </div>
    <div class="analysis-block" style="border-left-color:var(--success)">
      <div class="analysis-block-title">‚è∞ Th·ªùi gian h·ªçc t·ªëi ∆∞u cho b·∫°n</div>
      <div class="analysis-block-body">D·ª±a tr√™n k·∫øt qu·∫£ test t√≠nh c√°ch: Hi·ªáu qu·∫£ nh·∫•t v√†o <strong>t·ªëi 20:00‚Äì22:00</strong> v√† s√°ng Ch·ªß nh·∫≠t. H·ªçc theo block 90 ph√∫t, ngh·ªâ 15 ph√∫t.</div>
    </div>`;
}

async function runAIAnalysis() {
  const btn = document.getElementById('btn-run-ai');
  btn.innerHTML = `<div class="loading-dots"><span></span><span></span><span></span></div> ƒêang ph√¢n t√≠ch...`;
  btn.disabled = true;

  const gpa = (SUBJECTS.reduce((a, s) => a + s.score, 0) / SUBJECTS.length).toFixed(1);
  const weakList = SUBJECTS.filter(s => s.score < 7.5).map(s => `${s.name}(${s.score})`).join(', ');
  const strongList = SUBJECTS.filter(s => s.score >= 8.0).map(s => `${s.name}(${s.score})`).join(', ');

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 900,
        system: 'B·∫°n l√† AI StudyMate ‚Äî tr·ª£ l√Ω h·ªçc t·∫≠p th√¥ng minh cho h·ªçc sinh THCS/THPT Vi·ªát Nam. Ph√¢n t√≠ch ng·∫Øn g·ªçn, th·ª±c t·∫ø v√† d√πng ti·∫øng Vi·ªát ho√†n to√†n. D√πng emoji ph√π h·ª£p. Kh√¥ng d√πng markdown header (##). Ph·∫£n h·ªìi t·ª± nhi√™n nh∆∞ ng∆∞·ªùi th·∫ßy t·ªët b·ª•ng.',
        messages: [{
          role: 'user',
          content: `H√£y ph√¢n t√≠ch h·ªçc t·∫≠p cho t√¥i:\n‚Ä¢ L·ªõp ${APP.user.grade}\n‚Ä¢ GPA hi·ªán t·∫°i: ${gpa}/10\n‚Ä¢ M√¥n y·∫øu: ${weakList}\n‚Ä¢ M√¥n m·∫°nh: ${strongList}\n‚Ä¢ M·ª•c ti√™u: To√°n 9.0 trong 4 tu·∫ßn\n\nGi√∫p t√¥i:\n1. Nh·∫≠n x√©t t·ªïng quan (2‚Äì3 c√¢u)\n2. Chi·∫øn l∆∞·ª£c c·ª• th·ªÉ cho m√¥n y·∫øu nh·∫•t\n3. C√°ch duy tr√¨ m√¥n m·∫°nh\n4. M·ªôt c√¢u ƒë·ªông vi√™n ng·∫Øn\n\nTr·∫£ l·ªùi ng·∫Øn g·ªçn, th·ª±c t·∫ø, kh√¥ng d√†i d√≤ng.`
        }]
      })
    });
    const data = await res.json();
    const text = data.content?.[0]?.text || '';
    if (text) {
      document.getElementById('ai-output').innerHTML = `
        <div class="ai-response"><p>${text.replace(/\n/g, '<br>')}</p></div>
        <div id="ai-default-blocks"></div>`;
      buildAIDefaultBlocks();
      showToast('‚úÖ AI ƒë√£ ph√¢n t√≠ch xong!', 'success');
    }
  } catch (e) {
    showToast('‚ö†Ô∏è Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c AI. Hi·ªÉn th·ªã ph√¢n t√≠ch m·∫∑c ƒë·ªãnh.', 'warn');
  }

  btn.innerHTML = '‚ú¶ Ch·∫°y ph√¢n t√≠ch AI';
  btn.disabled = false;
}

// =====================================================
// PREDICT
// =====================================================
function buildPredictRings() {
  const container = document.getElementById('predict-rings');
  container.innerHTML = SUBJECTS.slice(0, 6).map(s => {
    const trend = s.score - s.prev;
    const pred = Math.min(10, parseFloat((s.score + trend * 0.7 + 0.08).toFixed(1)));
    const pct = (pred / 10 * 100);
    const r = 38, circ = 2 * Math.PI * r;
    const fill = (pct / 100) * circ;
    return `
      <div class="stat-card" style="text-align:center">
        <div style="font-size:12px;font-weight:700;color:var(--ink-3);margin-bottom:14px">${s.emoji} ${s.name}</div>
        <div class="pred-circle">
          <svg width="100" height="100" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="${r}" fill="none" stroke="var(--surface-2)" stroke-width="8"/>
            <circle cx="50" cy="50" r="${r}" fill="none" stroke="${s.color}" stroke-width="8"
              stroke-dasharray="${fill.toFixed(1)} ${circ.toFixed(1)}"
              stroke-linecap="round" style="filter:drop-shadow(0 0 4px ${s.color}88)"/>
          </svg>
          <div class="pred-text">
            <div class="pred-num" style="color:${scoreColor(pred)}">${pred}</div>
            <div class="pred-lbl">d·ª± ƒëo√°n</div>
          </div>
        </div>
        <div style="font-size:12px;color:var(--ink-3)">Hi·ªán: <b>${s.score}</b> ‚Üí M·ª•c ti√™u: <b>${s.target}</b></div>
      </div>`;
  }).join('');
}

function buildProbBars() {
  document.getElementById('prob-bars').innerHTML = SUBJECTS.slice(0, 6).map(s => {
    const trend = s.score - s.prev;
    const prob = Math.min(96, Math.max(15, Math.round(52 + trend * 22 + (s.score / s.target - 0.8) * 55)));
    return `
      <div style="margin-bottom:14px">
        <div style="display:flex;justify-content:space-between;margin-bottom:5px">
          <div style="font-size:13px;font-weight:600">${s.emoji} ƒê·∫°t m·ª•c ti√™u ${s.target} (${s.name})</div>
          <div style="font-size:14px;font-weight:800;font-family:var(--font-display);color:${prob >= 70 ? 'var(--success)' : 'var(--warn)'}">${prob}%</div>
        </div>
        <div class="progress-wrap" style="height:10px">
          <div class="progress-fill" style="width:${prob}%;background:${prob >= 70 ? 'var(--grad-success)' : 'var(--grad-warn)'}"></div>
        </div>
      </div>`;
  }).join('');
}

function initSimulation() {
  onSimChange(2);
}

function onSimChange(val) {
  document.getElementById('sim-hrs-val').textContent = val;
  const subj = document.getElementById('sim-subject')?.value || 'H√≥a h·ªçc';
  const base = SUBJECTS.find(s => s.name === subj)?.score || 6.5;
  const tgt = SUBJECTS.find(s => s.name === subj)?.target || 7.5;
  const newScore = Math.min(10, (base + parseFloat(val) * 0.3)).toFixed(1);
  document.getElementById('sim-msg').innerHTML = `üìà Th√™m <strong>${val} bu·ªïi/tu·∫ßn</strong> ‚Üí ${subj} c√≥ th·ªÉ tƒÉng t·ª´ <strong>${base}</strong> ‚Üí <strong>${newScore}</strong> sau 4 tu·∫ßn`;
  refreshSimChart();
}

function refreshSimChart() {
  const subj = document.getElementById('sim-subject')?.value || 'H√≥a h·ªçc';
  const val = parseInt(document.getElementById('sim-range')?.value || 2);
  const base = SUBJECTS.find(s => s.name === subj)?.score || 6.5;
  const target = SUBJECTS.find(s => s.name === subj)?.target || 7.5;
  const inc = val * 0.3;
  const withStudy = [base, +(base + inc * 0.22).toFixed(2), +(base + inc * 0.52).toFixed(2), +(base + inc * 0.78).toFixed(2), +(Math.min(10, base + inc)).toFixed(2)];
  const withoutStudy = [base, +(base + 0.04).toFixed(2), +(base + 0.08).toFixed(2), +(base + 0.1).toFixed(2), +(base + 0.12).toFixed(2)];

  if (APP.simChart) { APP.simChart.destroy(); APP.simChart = null; }
  const ctx = document.getElementById('chart-sim')?.getContext('2d');
  if (!ctx) return;

  APP.simChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Hi·ªán t·∫°i', 'Tu·∫ßn 1', 'Tu·∫ßn 2', 'Tu·∫ßn 3', 'Tu·∫ßn 4'],
      datasets: [
        { label: 'C√≥ h·ªçc th√™m', data: withStudy, borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.08)', fill: true, tension: 0.4, pointRadius: 5, borderWidth: 2.5 },
        { label: 'Kh√¥ng th√™m', data: withoutStudy, borderColor: '#b0b5cc', borderDash: [5, 5], tension: 0.3, pointRadius: 3, borderWidth: 1.5 },
        { label: `M·ª•c ti√™u ${target}`, data: Array(5).fill(target), borderColor: '#10c98a', borderDash: [3, 3], pointRadius: 0, borderWidth: 1.5 },
      ]
    },
    options: { ...chartBaseOpts(), scales: { x: chartScaleX(), y: { ...chartScaleY(), suggestedMin: Math.max(0, base - 0.5), suggestedMax: Math.min(10, target + 0.5) } } }
  });
}

// =====================================================
// QUIZ
// =====================================================
function initQuiz() {
  APP.quizIndex = 0;
  APP.quizAnswers = new Array(QUIZ_DATA.length).fill(null);
  document.getElementById('quiz-area').style.display = 'block';
  document.getElementById('quiz-result-area').style.display = 'none';
  renderQuizQuestion();
}

function renderQuizQuestion() {
  const q = QUIZ_DATA[APP.quizIndex];
  const total = QUIZ_DATA.length;
  document.getElementById('quiz-cat-label').textContent = q.cat;
  document.getElementById('quiz-num').textContent = `C√¢u ${APP.quizIndex + 1}/${total}`;

  // Dots
  document.getElementById('quiz-dots').innerHTML = QUIZ_DATA.map((_, i) => {
    let cls = 'step-dot pending';
    if (i < APP.quizIndex) cls = 'step-dot done';
    else if (i === APP.quizIndex) cls = 'step-dot active';
    return `<div class="${cls}"></div>`;
  }).join('');

  // Question & Options
  document.getElementById('quiz-content').innerHTML = `
    <div class="quiz-question-text">${APP.quizIndex + 1}. ${q.q}</div>
    <div class="quiz-options">
      ${q.opts.map((opt, i) => `
        <div class="quiz-option ${APP.quizAnswers[APP.quizIndex] === i ? 'selected' : ''}" onclick="selectQuizOption(${i})">
          <div class="quiz-radio"></div>
          <span>${opt}</span>
        </div>`).join('')}
    </div>`;

  document.getElementById('btn-quiz-prev').disabled = APP.quizIndex === 0;
  document.getElementById('btn-quiz-prev').style.opacity = APP.quizIndex === 0 ? '0.4' : '1';
  document.getElementById('btn-quiz-next').textContent = APP.quizIndex === total - 1 ? '‚úì Xem k·∫øt qu·∫£' : 'C√¢u ti·∫øp theo ‚Üí';
}

function selectQuizOption(i) {
  APP.quizAnswers[APP.quizIndex] = i;
  renderQuizQuestion();
}

function quizNext() {
  if (APP.quizIndex < QUIZ_DATA.length - 1) { APP.quizIndex++; renderQuizQuestion(); }
  else showPersonalityResult();
}

function quizPrev() {
  if (APP.quizIndex > 0) { APP.quizIndex--; renderQuizQuestion(); }
}

function showPersonalityResult() {
  // Compute personality type
  const traits = APP.quizAnswers.map((a, i) => a !== null ? QUIZ_DATA[i].traits[a] : null).filter(Boolean);
  const counts = {};
  traits.forEach(t => counts[t] = (counts[t] || 0) + 1);
  let type = 'default';
  if ((counts.social || 0) >= 4) type = 'social';
  else if ((counts.creative || 0) >= 3) type = 'creative';
  else if ((counts.analytical || 0) >= 3) type = 'analytical';

  const P = PERSONALITIES[type];
  document.getElementById('quiz-area').style.display = 'none';
  document.getElementById('quiz-result-area').style.display = 'block';
  document.getElementById('pers-emoji').textContent = P.emoji;
  document.getElementById('pers-type').textContent = P.type;
  document.getElementById('pers-desc').textContent = P.desc;
  document.getElementById('pers-extras').innerHTML = `
    <div class="analysis-block" style="border-left-color:var(--success)">
      <div class="analysis-block-title">‚úÖ ƒêi·ªÉm m·∫°nh c·ªßa b·∫°n</div>
      <div class="analysis-block-body">${P.strengths.map(s => `‚Ä¢ ${s}`).join('<br>')}</div>
    </div>
    <div class="analysis-block" style="border-left-color:var(--accent)">
      <div class="analysis-block-title">üõ†Ô∏è Ph∆∞∆°ng ph√°p ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t</div>
      <div class="analysis-block-body">${P.methods.map(m => `‚Ä¢ ${m}`).join('<br>')}</div>
    </div>`;
}

function resetQuiz() {
  document.getElementById('quiz-area').style.display = 'block';
  document.getElementById('quiz-result-area').style.display = 'none';
  initQuiz();
}

// =====================================================
// ROADMAP
// =====================================================
function buildRoadmap() {
  const weeks = [
    {
      n: 1, title: 'X√¢y n·ªÅn t·∫£ng v·ªØng ch·∫Øc', desc: 'L√Ω thuy·∫øt c∆° b·∫£n + B√†i t·∫≠p m·ª©c c∆° b·∫£n',
      status: 'ƒêang h·ªçc', statusBg: '#eff6ff', statusColor: '#667eea', badgeGrad: 'var(--grad-primary)',
      tasks: [
        { t: '√în l√Ω thuy·∫øt H√≥a h·ªØu c∆° ch∆∞∆°ng 1‚Äì3', done: true, time: '2h' },
        { t: 'L√†m 50 b√†i To√°n gi·∫£i t√≠ch c∆° b·∫£n', done: true, time: '3h' },
        { t: 'Luy·ªán 2 ƒë·ªÅ Ti·∫øng Anh Reading + ph√¢n t√≠ch', done: false, time: '2h' },
        { t: 'T·ªïng k·∫øt L·ªãch s·ª≠ giai ƒëo·∫°n 1930‚Äì1945', done: false, time: '1.5h' },
      ]
    },
    {
      n: 2, title: 'Luy·ªán t·∫≠p chuy√™n s√¢u', desc: 'B√†i t·∫≠p n√¢ng cao + Ph√¢n t√≠ch l·ªói sai',
      status: 'S·∫Øp b·∫Øt ƒë·∫ßu', statusBg: '#f0fdf4', statusColor: '#10c98a', badgeGrad: 'var(--grad-mint)',
      tasks: [
        { t: 'Gi·∫£i 20 b√†i H√≥a: B√†i to√°n ion v√† ƒëi·ªán ph√¢n', done: false, time: '3h' },
        { t: '√în H√¨nh h·ªçc kh√¥ng gian ‚Äì To√°n THPT', done: false, time: '3h' },
        { t: 'Vi·∫øt 5 b√†i IELTS Writing Task 2', done: false, time: '3h' },
        { t: 'L·ªãch s·ª≠: Kh√°ng chi·∫øn ch·ªëng M·ªπ c·ª©u n∆∞·ªõc', done: false, time: '2h' },
      ]
    },
    {
      n: 3, title: 'Ki·ªÉm tra & ƒêi·ªÅu ch·ªânh', desc: 'ƒê·ªÅ thi th·ª≠ + Ph√¢n t√≠ch k·∫øt qu·∫£',
      status: 'Ch∆∞a b·∫Øt ƒë·∫ßu', statusBg: '#f7f8fc', statusColor: '#b0b5cc', badgeGrad: 'var(--grad-violet)',
      tasks: [
        { t: 'ƒê·ªÅ thi th·ª≠ H√≥a h·ªçc 60 ph√∫t', done: false, time: '1h' },
        { t: 'Ki·ªÉm tra th·ª≠ To√°n d·∫°ng thi THPT Qu·ªëc gia', done: false, time: '1.5h' },
        { t: 'Mock test Ti·∫øng Anh 4 k·ªπ nƒÉng', done: false, time: '3h' },
        { t: 'Ph√¢n t√≠ch chi ti·∫øt t·∫•t c·∫£ sai s√≥t', done: false, time: '2h' },
      ]
    },
    {
      n: 4, title: 'Sprint n∆∞·ªõc r√∫t', desc: '√în t·ªïng h·ª£p + ƒê√°nh gi√° k·∫øt qu·∫£',
      status: 'Ch∆∞a b·∫Øt ƒë·∫ßu', statusBg: '#f7f8fc', statusColor: '#b0b5cc', badgeGrad: 'var(--grad-rose)',
      tasks: [
        { t: '√în t·∫≠p t·ªïng h·ª£p t·∫•t c·∫£ c√°c m√¥n', done: false, time: 'Li√™n t·ª•c' },
        { t: 'L√†m l·∫°i c√°c d·∫°ng b√†i t·ª´ng sai', done: false, time: '4h' },
        { t: 'ƒê√°nh gi√° k·∫øt qu·∫£ & L·∫≠p k·∫ø ho·∫°ch T3', done: false, time: '1h' },
      ]
    }
  ];

  document.getElementById('roadmap-weeks-container').innerHTML = weeks.map((w, wi) => `
    <div class="week-card">
      <div class="week-header" onclick="toggleWeek('wb-${wi}', 'we-${wi}')">
        <div class="week-header-left">
          <div class="week-badge" style="background:${w.badgeGrad}">W${w.n}</div>
          <div>
            <div class="week-title">${w.title}</div>
            <div class="week-desc">${w.desc}</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px">
          <div class="week-status-pill" style="background:${w.statusBg};color:${w.statusColor}">${w.status}</div>
          <span id="we-${wi}" style="color:var(--ink-3);font-size:12px;transition:transform 0.2s">${wi === 0 ? '‚ñ≤' : '‚ñº'}</span>
        </div>
      </div>
      <div class="week-body" id="wb-${wi}" style="display:${wi === 0 ? 'block' : 'none'}">
        <div class="week-body-inner">
          ${w.tasks.map((t, ti) => `
            <div class="task-item">
              <div class="task-checkbox${t.done ? ' checked' : ''}" onclick="toggleTask(this)" data-done="${t.done}"></div>
              <div>
                <div class="task-text${t.done ? ' done' : ''}">${t.t}</div>
                <div class="task-time">‚è± ${t.time}</div>
              </div>
            </div>`).join('')}
        </div>
      </div>
    </div>`).join('');

  document.getElementById('roadmap-timeline').innerHTML = [
    { time: 'Tu·∫ßn 1 ¬∑ 01‚Äì07/3/2026', title: 'N·ªÅn t·∫£ng: H√≥a h·ªØu c∆° + To√°n', sub: '2h To√°n + 2h H√≥a m·ªói ng√†y', s: 'now' },
    { time: 'Tu·∫ßn 2 ¬∑ 08‚Äì14/3/2026', title: 'Chuy√™n s√¢u: H√≥a ion + H√¨nh h·ªçc', sub: 'TƒÉng c∆∞·ªùng H√≥a h·ªçc', s: 'upcoming' },
    { time: 'Tu·∫ßn 3 ¬∑ 15‚Äì21/3/2026', title: 'Ki·ªÉm tra th·ª≠ to√†n b·ªô c√°c m√¥n', sub: 'Ph√¢n t√≠ch k·ªπ sai s√≥t', s: 'upcoming' },
    { time: 'Tu·∫ßn 4 ¬∑ 22‚Äì28/3/2026', title: 'Sprint: √în t·∫≠p t·ªïng h·ª£p', sub: 'C·ªßng c·ªë ƒëi·ªÉm y·∫øu cu·ªëi c√πng', s: 'upcoming' },
    { time: 'Th√°ng 4/2026', title: 'üéØ ƒê√°nh gi√° & L·∫≠p k·∫ø ho·∫°ch m·ªõi', sub: 'GPA m·ª•c ti√™u: 8.5+', s: 'upcoming' },
  ].map(t => `
    <div class="tl-item">
      <div class="tl-dot ${t.s}"></div>
      <div class="tl-time">${t.time}</div>
      <div class="tl-title">${t.title}</div>
      <div class="tl-sub">${t.sub}</div>
    </div>`).join('');
}

function toggleWeek(bodyId, arrowId) {
  const body = document.getElementById(bodyId);
  const arrow = document.getElementById(arrowId);
  const isOpen = body.style.display !== 'none';
  body.style.display = isOpen ? 'none' : 'block';
  if (arrow) arrow.textContent = isOpen ? '‚ñº' : '‚ñ≤';
}

function toggleTask(el) {
  el.classList.toggle('checked');
  const txt = el.nextElementSibling?.querySelector('.task-text');
  if (txt) txt.classList.toggle('done', el.classList.contains('checked'));
}

// =====================================================
// EXAM
// =====================================================
function setExamDiff(el, val) {
  APP.examDiff = val;
  document.querySelectorAll('#exam-diff-tabs .tab-pill').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}

function launchExam() {
  const subj = document.getElementById('exam-subject-sel').value;
  const count = parseInt(document.getElementById('exam-count-sel').value);
  const bank = EXAM_BANK[subj] || EXAM_BANK['H√≥a h·ªçc'];
  APP.examData = [...bank].sort(() => Math.random() - 0.5).slice(0, Math.min(count, bank.length));
  APP.examAnswers = {};

  document.getElementById('exam-config-panel').style.display = 'none';
  document.getElementById('exam-area-panel').style.display = 'block';
  document.getElementById('exam-heading').textContent = `ƒê·ªÅ √¥n t·∫≠p ${subj} ‚Äî ${APP.examDiff === 'easy' ? 'C∆° b·∫£n' : APP.examDiff === 'medium' ? 'Trung b√¨nh' : 'N√¢ng cao'}`;
  document.getElementById('exam-subheading').textContent = `${APP.examData.length} c√¢u ¬∑ AI Generated ¬∑ ${new Date().toLocaleDateString('vi-VN')}`;

  document.getElementById('exam-questions-container').innerHTML = APP.examData.map((q, qi) => `
    <div class="exam-q-card">
      <div class="exam-q-text"><span class="exam-q-num">C√¢u ${qi + 1}</span>${q.q}</div>
      <div class="exam-options">
        ${q.opts.map((opt, oi) => `
          <div class="exam-option" id="eo-${qi}-${oi}" onclick="pickExamOpt(${qi},${oi})">
            <div class="opt-letter">${String.fromCharCode(65 + oi)}</div>
            <span>${opt}</span>
          </div>`).join('')}
      </div>
    </div>`).join('');

  APP.examTimeLeft = APP.examData.length * 90;
  updateExamTimerDisplay();
  clearInterval(APP.examTimer);
  APP.examTimer = setInterval(() => {
    APP.examTimeLeft--;
    updateExamTimerDisplay();
    if (APP.examTimeLeft <= 0) { clearInterval(APP.examTimer); submitExam(); }
  }, 1000);
}

function updateExamTimerDisplay() {
  const m = Math.floor(APP.examTimeLeft / 60), s = APP.examTimeLeft % 60;
  const el = document.getElementById('exam-timer-display');
  if (!el) return;
  el.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  el.className = 'exam-timer' + (APP.examTimeLeft < 60 ? ' danger' : APP.examTimeLeft < 180 ? ' warn' : '');
}

function pickExamOpt(qi, oi) {
  document.querySelectorAll(`[id^="eo-${qi}-"]`).forEach(el => el.classList.remove('selected'));
  document.getElementById(`eo-${qi}-${oi}`).classList.add('selected');
  APP.examAnswers[qi] = oi;
}

function submitExam() {
  clearInterval(APP.examTimer);
  let correct = 0;
  const wrongExplanations = [];
  APP.examData.forEach((q, qi) => {
    const ua = APP.examAnswers[qi];
    document.querySelectorAll(`[id^="eo-${qi}-"]`).forEach((el, oi) => {
      el.style.pointerEvents = 'none';
      if (oi === q.ans) el.classList.add('correct');
      else if (oi === ua && ua !== q.ans) el.classList.add('wrong');
    });
    if (ua === q.ans) correct++;
    else wrongExplanations.push({ num: qi + 1, exp: q.exp });
  });

  const pct = Math.round(correct / APP.examData.length * 100);
  const scoreVal = (correct / APP.examData.length * 10).toFixed(1);

  setTimeout(() => {
    document.getElementById('exam-area-panel').style.display = 'none';
    document.getElementById('exam-result-panel').style.display = 'block';
    document.getElementById('exam-result-emoji').textContent = pct >= 80 ? 'üéâ' : pct >= 60 ? 'üìö' : 'üí™';
    const sc = document.getElementById('exam-result-score');
    sc.textContent = `${correct}/${APP.examData.length} c√¢u ƒë√∫ng ‚Äî ${scoreVal} ƒëi·ªÉm`;
    sc.style.color = pct >= 80 ? 'var(--success)' : pct >= 60 ? 'var(--accent)' : 'var(--warn)';
    document.getElementById('exam-result-msg').textContent = pct >= 80 ? 'Xu·∫•t s·∫Øc! B·∫°n ƒë√£ n·∫Øm v·ªØng ph·∫ßn n√†y.' : pct >= 60 ? 'T·ªët! H√£y xem l·∫°i c√°c c√¢u sai ƒë·ªÉ c·ªßng c·ªë th√™m.' : 'C·∫ßn √¥n t·∫≠p th√™m! ƒê·ª´ng n·∫£n, m·ªói l·∫ßn sai l√† m·ªôt l·∫ßn h·ªçc.';
    document.getElementById('exam-result-feedback').innerHTML = wrongExplanations.length
      ? `<div class="analysis-block" style="border-left-color:var(--warn)">
          <div class="analysis-block-title">üìñ Gi·∫£i th√≠ch ${wrongExplanations.length} c√¢u sai</div>
          <div class="analysis-block-body">${wrongExplanations.map(w => `<div style="margin-bottom:7px"><b>C√¢u ${w.num}:</b> ${w.exp}</div>`).join('')}</div>
        </div>`
      : `<div class="alert alert-success"><div class="alert-icon">üèÜ</div><div class="alert-body"><strong>Tuy·ªát v·ªùi! Kh√¥ng c√≥ c√¢u n√†o sai c·∫£!</strong></div></div>`;
  }, 600);
}

function retryExam() {
  document.getElementById('exam-result-panel').style.display = 'none';
  APP.examAnswers = {};
  launchExam();
}

function newExam() {
  document.getElementById('exam-result-panel').style.display = 'none';
  document.getElementById('exam-config-panel').style.display = 'block';
}

// =====================================================
// SCHEDULE
// =====================================================
function buildSchedule() {
  const days = ['Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7', 'CN'];
  const slots = ['S√°ng 6‚Äì8h', 'S√°ng 8‚Äì10h', 'Chi·ªÅu 14‚Äì16h', 'Chi·ªÅu 16‚Äì18h', 'T·ªëi 20‚Äì22h'];
  const grid = [
    ['To√°n', 'V·∫≠t l√Ω', '', 'H√≥a h·ªçc', 'Ti·∫øng Anh'],
    ['Ng·ªØ vƒÉn', 'To√°n', 'H√≥a h·ªçc', '', 'Ti·∫øng Anh'],
    ['V·∫≠t l√Ω', '', 'To√°n', 'L·ªãch s·ª≠', 'H√≥a h·ªçc'],
    ['To√°n', 'H√≥a h·ªçc', '', 'V·∫≠t l√Ω', 'Ti·∫øng Anh'],
    ['', 'Ng·ªØ vƒÉn', 'To√°n', '', 'H√≥a h·ªçc'],
    ['Ngh·ªâ ng∆°i', 'To√°n', 'Ti·∫øng Anh', 'H√≥a h·ªçc', '√în t·ªïng h·ª£p'],
    ['Ngh·ªâ ng∆°i', '', '√în l√Ω thuy·∫øt', 'To√°n', 'Ti·∫øng Anh'],
  ];
  const colorMap = { 'To√°n': '#667eea', 'V·∫≠t l√Ω': '#764ba2', 'H√≥a h·ªçc': '#f5576c', 'Ti·∫øng Anh': '#4facfe', 'Ng·ªØ vƒÉn': '#fa709a', 'L·ªãch s·ª≠': '#a18cd1', '√în t·ªïng h·ª£p': '#43e97b', '√în l√Ω thuy·∫øt': '#43e97b', 'Ngh·ªâ ng∆°i': '#e8eaf4' };

  const wrap = document.createElement('div');
  wrap.className = 'sched-wrapper';
  const table = document.createElement('table');
  table.className = 'sched-table';
  table.innerHTML = `
    <thead><tr>
      <th>Khung gi·ªù</th>
      ${days.map(d => `<th>${d}</th>`).join('')}
    </tr></thead>
    <tbody>
      ${slots.map((slot, si) => `
        <tr>
          <td><div class="sched-slot-label">${slot}</div></td>
          ${days.map((_, di) => {
            const subj = grid[di][si] || '';
            const col = colorMap[subj] || 'transparent';
            return `<td>
              <div class="sched-cell" style="background:${subj ? col + '18' : 'transparent'};color:${col !== 'transparent' ? col : 'var(--ink-4)'};border:1px solid ${subj ? col + '33' : 'transparent'}">
                ${subj || '‚Äì'}
              </div>
            </td>`;
          }).join('')}
        </tr>`).join('')}
    </tbody>`;
  wrap.appendChild(table);
  document.getElementById('schedule-table-wrap').innerHTML = '';
  document.getElementById('schedule-table-wrap').appendChild(wrap);

  document.getElementById('study-methods-grid').innerHTML = [
    { ico: 'üçÖ', title: 'Pomodoro 25/5', desc: '25 ph√∫t t·∫≠p trung cao ƒë·ªô ‚Üí 5 ph√∫t ngh·ªâ. Sau 4 v√≤ng ngh·ªâ 30 ph√∫t. TƒÉng hi·ªáu su·∫•t h·ªçc t·∫≠p l√™n 40%.' },
    { ico: 'üóÇÔ∏è', title: 'Spaced Repetition', desc: '√în l·∫°i theo chu k·ª≥: 1 ng√†y, 3 ng√†y, 7 ng√†y, 21 ng√†y. Nh·ªõ l√¢u g·∫•p 5 l·∫ßn so v·ªõi h·ªçc nh·ªìi nh√©t.' },
    { ico: 'üß†', title: 'Feynman Technique', desc: 'Sau khi h·ªçc xong, t·ª± gi·∫£i th√≠ch nh∆∞ ƒëang d·∫°y ng∆∞·ªùi kh√°c. Ph√°t hi·ªán ngay l·ªó h·ªïng ki·∫øn th·ª©c.' },
    { ico: 'üó∫Ô∏è', title: 'Mind Mapping', desc: 'V·∫Ω s∆° ƒë·ªì t∆∞ duy m√†u s·∫Øc tr∆∞·ªõc m·ªói ch∆∞∆°ng. K·∫øt n·ªëi ki·∫øn th·ª©c tr·ª±c quan, d·ªÖ nh·ªõ v√† h·ªá th·ªëng.' },
  ].map(m => `
    <div class="analysis-block" style="border-left-color:var(--accent)">
      <div class="analysis-block-title">${m.ico} ${m.title}</div>
      <div class="analysis-block-body">${m.desc}</div>
    </div>`).join('');
}

// =====================================================
// PROGRESS
// =====================================================
function buildProgressStats() {
  const gpa2 = (SUBJECTS.reduce((a, s) => a + s.score, 0) / SUBJECTS.length).toFixed(1);
  const gpa1 = (SUBJECTS.reduce((a, s) => a + s.prev, 0) / SUBJECTS.length).toFixed(1);
  const improved = SUBJECTS.filter(s => s.score > s.prev).length;
  const dropped = SUBJECTS.filter(s => s.score < s.prev).length;

  document.getElementById('progress-stat-cards').innerHTML = [
    { icon: 'üìä', label: 'GPA Th√°ng 2', val: gpa2, ch: `‚ñ≤ +${(parseFloat(gpa2) - parseFloat(gpa1)).toFixed(1)} so T1`, cls: 'change-up', g: 'var(--grad-success)' },
    { icon: 'üìÖ', label: 'GPA Th√°ng 1', val: gpa1, ch: 'K·ª≥ tr∆∞·ªõc', cls: 'change-nu', g: 'var(--grad-primary)' },
    { icon: 'üìà', label: 'M√¥n tƒÉng ƒëi·ªÉm', val: `${improved}/${SUBJECTS.length}`, ch: 'so th√°ng tr∆∞·ªõc', cls: 'change-up', g: 'var(--grad-mint)' },
    { icon: 'üìâ', label: 'M√¥n gi·∫£m ƒëi·ªÉm', val: dropped, ch: 'c·∫ßn ch√∫ √Ω', cls: 'change-dn', g: 'var(--grad-danger)' },
  ].map(d => `
    <div class="stat-card">
      <div class="stat-card-accent" style="background:${d.g}"></div>
      <div class="stat-icon" style="background:${d.g}"><span style="font-size:20px">${d.icon}</span></div>
      <div class="stat-label">${d.label}</div>
      <div class="stat-value">${d.val}</div>
      <div class="stat-change ${d.cls}">${d.ch}</div>
    </div>`).join('');
}

function buildCompareTable() {
  document.getElementById('compare-table').innerHTML = `
    <thead><tr>
      <th>M√¥n h·ªçc</th>
      <th>Th√°ng 1</th>
      <th>Th√°ng 2</th>
      <th>Thay ƒë·ªïi</th>
      <th>M·ª•c ti√™u</th>
      <th>Ti·∫øn ƒë·ªô</th>
    </tr></thead>
    <tbody>
      ${SUBJECTS.map(s => {
        const ch = s.score - s.prev;
        const pct = Math.min(100, (s.score / s.target * 100)).toFixed(0);
        return `<tr>
          <td><div style="display:flex;align-items:center;gap:7px;font-weight:700">${s.emoji} ${s.name}</div></td>
          <td style="font-family:var(--font-display);font-weight:700;color:var(--ink-3)">${s.prev}</td>
          <td><span style="font-family:var(--font-display);font-size:15px;font-weight:800;color:${scoreColor(s.score)}">${s.score}</span></td>
          <td><span style="font-weight:800;color:${ch >= 0 ? 'var(--success)' : 'var(--danger)'}">${ch >= 0 ? '+' : ''}${ch.toFixed(1)}</span></td>
          <td style="font-weight:600;color:var(--ink-3)">${s.target}</td>
          <td>
            <div style="display:flex;align-items:center;gap:8px">
              <div class="progress-wrap" style="flex:1;height:8px"><div class="progress-fill" style="width:${pct}%;background:${parseInt(pct) >= 100 ? 'var(--grad-success)' : 'var(--grad-primary)'}"></div></div>
              <span style="font-size:11px;color:var(--ink-3);font-weight:700;min-width:30px">${pct}%</span>
            </div>
          </td>
        </tr>`;
      }).join('')}
    </tbody>`;
}

// =====================================================
// ALERTS
// =====================================================
function buildAlerts() {
  const alerts = [
    { type: 'danger', icon: 'üî¥', title: 'H√≥a h·ªçc gi·∫£m m·∫°nh 1.2 ƒëi·ªÉm!', msg: 'ƒêi·ªÉm H√≥a h·ªçc t·ª´ 7.7 ‚Üí 6.5. M·ª©c gi·∫£m ƒë√°ng lo ng·∫°i. AI g·ª£i √Ω: TƒÉng ngay 2‚Äì3 bu·ªïi √¥n/tu·∫ßn, t·∫≠p trung H√≥a h·ªØu c∆° v√† b√†i to√°n ion.', time: '2 ng√†y tr∆∞·ªõc', read: false },
    { type: 'warn', icon: 'üü°', title: 'Deadline l·ªô tr√¨nh tu·∫ßn 1 s·∫Øp h·∫øt!', msg: 'C√≤n 2/4 nhi·ªám v·ª• ch∆∞a ho√†n th√†nh trong tu·∫ßn 1. C·∫ßn ho√†n th√†nh tr∆∞·ªõc ng√†y 07/03/2026.', time: 'H√¥m nay', read: false },
    { type: 'success', icon: 'üü¢', title: 'To√°n ƒëang ti·∫øn b·ªô xu·∫•t s·∫Øc!', msg: 'ƒêi·ªÉm To√°n tƒÉng 0.8 ƒëi·ªÉm l√™n 8.7 ‚Äî ti·∫øn b·ªô nhanh nh·∫•t trong c√°c m√¥n! D·ª± ƒëo√°n ƒë·∫°t 9.0 v√†o th√°ng 4.', time: '3 ng√†y tr∆∞·ªõc', read: false },
    { type: 'info', icon: 'üíô', title: 'Nh·∫Øc nh·ªü: Gi·ªù √¥n To√°n t·ªëi nay', msg: '20:00 ‚Äî ƒê·∫øn gi·ªù √¥n To√°n! H√¥m nay √¥n ch·ªß ƒë·ªÅ H√¨nh h·ªçc kh√¥ng gian. Chu·∫©n b·ªã gi·∫•y nh√°p v√† m√°y t√≠nh.', time: 'T·ªëi nay 20:00', read: true },
    { type: 'warn', icon: 'üü°', title: 'L·ªãch s·ª≠ c√≥ xu h∆∞·ªõng gi·∫£m nh·∫π', msg: 'L·ªãch s·ª≠ t·ª´ 7.0 ‚Üí 6.8. Ch∆∞a nguy hi·ªÉm nh∆∞ng c·∫ßn ch√∫ √Ω. G·ª£i √Ω: L·∫≠p timeline s·ª± ki·ªán theo t·ª´ng th·ªùi k·ª≥.', time: '1 tu·∫ßn tr∆∞·ªõc', read: true },
    { type: 'info', icon: 'üìä', title: 'B√°o c√°o ti·∫øn b·ªô th√°ng 2/2026', msg: 'GPA th√°ng 2: 8.2/10 (+0.3 so th√°ng 1). Xem chi ti·∫øt ph√¢n t√≠ch trong m·ª•c Ti·∫øn b·ªô theo th√°ng.', time: '01/02/2026', read: true },
  ];

  document.getElementById('alerts-container').innerHTML = alerts.map((a, i) => `
    <div class="alert alert-${a.type}" style="margin-bottom:10px;${a.read ? 'opacity:0.65' : ''}" id="alert-item-${i}">
      <div class="alert-icon">${a.icon}</div>
      <div class="alert-body" style="flex:1">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px">
          <strong>${a.title}</strong>
          <span style="font-size:11px;opacity:0.7;white-space:nowrap;font-weight:600">${a.time}</span>
        </div>
        <p>${a.msg}</p>
      </div>
    </div>`).join('');
}

function markAllRead() {
  document.querySelectorAll('[id^="alert-item-"]').forEach(el => el.style.opacity = '0.65');
  document.getElementById('alert-badge').style.display = 'none';
  showToast('‚úÖ ƒê√£ ƒë√°nh d·∫•u t·∫•t c·∫£ l√† ƒë√£ ƒë·ªçc', 'success');
}

// =====================================================
// CHARTS
// =====================================================
function chartBaseOpts() {
  return {
    responsive: true,
    maintainAspectRatio: true,
    plugins: {
      legend: { labels: { color: '#7c82a8', font: { family: 'Plus Jakarta Sans', size: 11, weight: '600' }, padding: 16, boxWidth: 12 } }
    }
  };
}
function chartScaleX() { return { grid: { color: 'rgba(0,0,0,0.04)', drawBorder: false }, ticks: { color: '#b0b5cc', font: { family: 'Plus Jakarta Sans', size: 11 } } }; }
function chartScaleY(min, max) { return { grid: { color: 'rgba(0,0,0,0.04)', drawBorder: false }, ticks: { color: '#b0b5cc', font: { family: 'Plus Jakarta Sans', size: 11 } }, suggestedMin: min, suggestedMax: max }; }

function initCharts() {
  // RADAR
  const rc = document.getElementById('chart-radar');
  if (rc && !APP.charts.radar) {
    APP.charts.radar = new Chart(rc.getContext('2d'), {
      type: 'radar',
      data: {
        labels: SUBJECTS.map(s => s.name),
        datasets: [
          { label: 'Th√°ng 2', data: SUBJECTS.map(s => s.score), borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.12)', pointBackgroundColor: '#667eea', pointRadius: 4, borderWidth: 2 },
          { label: 'M·ª•c ti√™u', data: SUBJECTS.map(s => s.target), borderColor: '#10c98a', backgroundColor: 'rgba(16,201,138,0.05)', borderDash: [5, 5], pointRadius: 3, borderWidth: 1.5 },
        ]
      },
      options: {
        responsive: true, maintainAspectRatio: true,
        plugins: { legend: { labels: { color: '#7c82a8', font: { family: 'Plus Jakarta Sans', size: 11 }, padding: 12 } } },
        scales: { r: { grid: { color: 'rgba(0,0,0,0.06)' }, pointLabels: { color: '#7c82a8', font: { size: 11, family: 'Plus Jakarta Sans' } }, ticks: { display: false, backdropColor: 'transparent' }, suggestedMin: 5, suggestedMax: 10, angleLines: { color: 'rgba(0,0,0,0.06)' } } }
      }
    });
  }

  // GPA LINE
  const gc = document.getElementById('chart-gpa');
  if (gc && !APP.charts.gpa) {
    APP.charts.gpa = new Chart(gc.getContext('2d'), {
      type: 'line',
      data: {
        labels: MONTHLY_DATA.labels,
        datasets: [
          { label: 'GPA', data: MONTHLY_DATA.gpa, borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.1)', fill: true, tension: 0.4, pointRadius: 5, pointBackgroundColor: '#667eea', borderWidth: 2.5 },
          { label: 'To√°n', data: MONTHLY_DATA.toan, borderColor: '#4facfe', tension: 0.4, pointRadius: 3, borderWidth: 1.5 },
          { label: 'H√≥a h·ªçc', data: MONTHLY_DATA.hoahoc, borderColor: '#f5576c', tension: 0.4, pointRadius: 3, borderWidth: 1.5 },
        ]
      },
      options: { ...chartBaseOpts(), scales: { x: chartScaleX(), y: chartScaleY(6, 10) } }
    });
  }

  // BAR CHART (Analysis)
  const bc = document.getElementById('chart-bar');
  if (bc && !APP.charts.bar) {
    APP.charts.bar = new Chart(bc.getContext('2d'), {
      type: 'bar',
      data: {
        labels: SUBJECTS.map(s => s.name),
        datasets: [
          { label: 'Th√°ng 1', data: SUBJECTS.map(s => s.prev), backgroundColor: 'rgba(176,181,204,0.5)', borderRadius: 6, borderSkipped: false },
          { label: 'Th√°ng 2', data: SUBJECTS.map(s => s.score), backgroundColor: SUBJECTS.map(s => s.score >= s.prev ? 'rgba(67,233,123,0.7)' : 'rgba(245,87,108,0.7)'), borderRadius: 6, borderSkipped: false },
          { label: 'M·ª•c ti√™u', data: SUBJECTS.map(s => s.target), type: 'line', borderColor: 'rgba(102,126,234,0.5)', borderDash: [4, 4], pointRadius: 0, tension: 0.3, borderWidth: 1.5 },
        ]
      },
      options: { ...chartBaseOpts(), scales: { x: chartScaleX(), y: chartScaleY(5, 10) } }
    });
  }

  // PROGRESS CHART
  const pc = document.getElementById('chart-progress');
  if (pc && !APP.charts.progress) {
    APP.charts.progress = new Chart(pc.getContext('2d'), {
      type: 'line',
      data: {
        labels: MONTHLY_DATA.labels,
        datasets: [
          { label: 'GPA', data: MONTHLY_DATA.gpa, borderColor: '#667eea', backgroundColor: 'rgba(102,126,234,0.08)', fill: true, tension: 0.4, pointRadius: 5, borderWidth: 2.5 },
          { label: 'To√°n', data: MONTHLY_DATA.toan, borderColor: '#4facfe', tension: 0.4, pointRadius: 4, borderWidth: 2 },
          { label: 'H√≥a h·ªçc', data: MONTHLY_DATA.hoahoc, borderColor: '#f5576c', tension: 0.4, pointRadius: 4, borderWidth: 2 },
          { label: 'Ti·∫øng Anh', data: MONTHLY_DATA.tienganh, borderColor: '#10c98a', tension: 0.4, pointRadius: 4, borderWidth: 2 },
          { label: 'L·ªãch s·ª≠', data: MONTHLY_DATA.lichsu, borderColor: '#a18cd1', tension: 0.4, pointRadius: 3, borderWidth: 1.5 },
        ]
      },
      options: { ...chartBaseOpts(), scales: { x: chartScaleX(), y: chartScaleY(5.5, 10) } }
    });
  }

  // Init sim chart
  refreshSimChart();
}

function rebuildCharts() {
  ['radar', 'gpa', 'bar', 'progress'].forEach(k => {
    if (APP.charts[k]) { APP.charts[k].destroy(); APP.charts[k] = null; }
  });
  setTimeout(initCharts, 100);
}

</script>
</body>
</html>
